<tool id="anvi_mcg_classifier" name="anvi-mcg-classifier" version="5.2">
    <description>A program to classify genes according to coverage across multiple metagenomes</description>
    <requirements>
        <requirement type="package" version="5.2">anvio</requirement>
    </requirements>
    <stdio>
        <exit_code range="1:" />
    </stdio>
    <version_command>anvi-mcg-classifier --version</version_command>
    <command><![CDATA[
        cp -R '${input_profile_db.extra_files_path}' '${output_profile_db.extra_files_path}'
 && 
cp -R '${input_contigs_db.extra_files_path}' '${output_contigs_db.extra_files_path}'
 && 
mkdir ${output_file_prefix.extra_files_path}
 &&
 anvi-mcg-classifier
--profile-db '${output_profile_db.extra_files_path}/PROFILE.db'

--contigs-db '${output_contigs_db.extra_files_path}/CONTIGS.db'


#if $str( $output_file_prefix ):
    --output-file-prefix 'output_file_prefix'
#end if


#if $str( $collection_name ):
    --collection-name '${collection_name}'
#end if


#if $str( $bin_id ):
    --bin-id '${bin_id}'
#end if


#if $bin_ids_file:
    --bin-ids-file '${bin_ids_file}'
#end if


#if $exclude_samples:
    --exclude-samples '${exclude_samples}'
#end if


#if $include_samples:
    --include-samples '${include_samples}'
#end if

${gen_figures}

${get_samples_stats_only}

${overwrite_output_destinations}


#if $str( $genome_detection_uncertainty ):
    --genome-detection-uncertainty '${genome_detection_uncertainty}'
#end if


#if $str( $outliers_threshold ):
    --outliers-threshold '${outliers_threshold}'
#end if

${zeros_are_outliers}

&> '${GALAXY_ANVIO_LOG}'

 &&
 ( cp output_file_prefix* '${output_file_prefix.extra_files_path}/' || echo '' )
 &&
ls -lahR
    ]]></command>
    <inputs>
        <param name="input_profile_db" type="data" label="Profile Db" format="anvio_profile_db" optional="False" multiple="False" argument="--profile-db" help="Anvi'o profile database"/>
        <param name="input_contigs_db" type="data" label="Contigs Db" format="anvio_contigs_db" optional="False" multiple="False" argument="--contigs-db" help="Anvi'o contigs database generated by 'anvi-gen-contigs'"/>
        <param name="collection_name" type="text" label="Collection Name" value="" optional="True" argument="--collection-name" help="Collection name."/>
        <param name="bin_id" type="text" label="Bin Id" value="" optional="True" argument="--bin-id" help="Bin name you are interested in."/>
        <param name="bin_ids_file" type="data" label="Bin Ids File" format="txt" optional="True" multiple="False" argument="--bin-ids-file" help="Text file for bins (each line should be a unique bin id)."/>
        <param name="exclude_samples" type="data" label="Exclude Samples" format="txt" optional="True" multiple="False" argument="--exclude-samples" help="List of samples to exclude for the analysis."/>
        <param name="include_samples" type="data" label="Include Samples" format="txt" optional="True" multiple="False" argument="--include-samples" help="List of samples to include for the analysis."/>
        <param name="gen_figures" type="boolean" label="Gen Figures" truevalue="--gen-figures" falsevalue="" checked="False" optional="True" argument="--gen-figures" help="For those of you who wish to dig deeper, a collection of figures could be created to allow you to get insight into how the classification was generated. This is especially useful to identify cases in which you shouldn't trust the classification (for example due to a large number of outliers). NOTICE: if you ask anvi'o to generate these figures then it will significantly extend the execution time. To learn about which figures are created and what they mean, contact your nearest anvi'o developer, because currently it is a well-hidden secret."/>
        <param name="get_samples_stats_only" type="boolean" label="Get Samples Stats Only" truevalue="--get-samples-stats-only" falsevalue="" checked="False" optional="True" argument="--get-samples-stats-only" help="If you only wish to get statistics regarding the occurence of bins in samples, then use this flag. Especially when dealing with many samples or large genomes, gene stats could be a long time to compute. By using this flag you could save a lot of computation time."/>
        <param name="overwrite_output_destinations" type="boolean" label="Overwrite Output Destinations" truevalue="--overwrite-output-destinations" falsevalue="" checked="False" optional="True" argument="--overwrite-output-destinations" help="Overwrite if the output files and/or directories exist."/>
        <param name="genome_detection_uncertainty" type="text" label="Genome Detection Uncertainty" value="0.25" optional="True" argument="--genome-detection-uncertainty" help="Determines the range of sample detection values that are considered negative, ambiguous or positive. Min of 0 and smaller than 0.5, default of 0.25. For exmaple for the default samples with detection below 0.5-0.25 = 0.25 will be considered negative (i.e. donot contain the genome), samples with detection between 0.25 and 0.75 would be ambiguous (and hence would not be used for the classification), and samples with detection above 0.75 would be considered positive (i.e. contain the genome)."/>
        <param name="outliers_threshold" type="text" label="Outliers Threshold" value="1.5" optional="True" argument="--outliers-threshold" help="Threshold to use for the outlier detection. The default value is '%(default).1f'. Absolute deviation around the median is used. To read more about the method please refer to: 'How to Detect and Handle Outliers' by Boris Iglewicz and David Hoaglin (doi:10.1016/j.jesp.2013.03.013)."/>
        <param name="zeros_are_outliers" type="boolean" label="Zeros Are Outliers" truevalue="--zeros-are-outliers" falsevalue="" checked="False" optional="True" argument="--zeros-are-outliers" help="If you want all zero coverage positions to be treated like outliers then use this flag. The reason to treat zero coverage as outliers is because when mapping reads to a reference we could get many zero positions due to accessory genes. These positions then skew the average values that we compute."/>
    </inputs>
    <outputs>
        <data name="output_profile_db" format="anvio_profile_db" format_source="input_profile_db" metadata_source="input_profile_db" label="${tool.name} on ${on_string}: Profile Db"/>
        <data name="output_contigs_db" format="anvio_contigs_db" format_source="input_contigs_db" metadata_source="input_contigs_db" label="${tool.name} on ${on_string}: Contigs Db"/>
        <data name="output_file_prefix" format="anvio_composite" format_source="input_output_file_prefix" metadata_source="input_output_file_prefix" label="${tool.name} on ${on_string}: Output File Prefix"/>
        <data name="GALAXY_ANVIO_LOG" format="txt" label="${tool.name} on ${on_string}: Log"/>
    </outputs>
    <help><![CDATA[
        usage: anvi-mcg-classifier [-h] -p PROFILE_DB -c CONTIGS_DB
                              [-O FILENAME_PREFIX] [-C COLLECTION_NAME]
                              [-b BIN_NAME] [-B FILE_PATH]
                              [--exclude-samples FILE]
                              [--include-samples FILE] [--gen-figures]
                              [--get-samples-stats-only] [-W] [--alpha NUM]
                              [--outliers-threshold NUM]
                              [--zeros-are-outliers]

A program to classify genes according to coverage across multiple metagenomes

optional arguments:
  -h, --help            show this help message and exit
  -p PROFILE_DB, --profile-db PROFILE_DB
                        Anvi'o profile database
  -c CONTIGS_DB, --contigs-db CONTIGS_DB
                        Anvi'o contigs database generated by 'anvi-gen-
                        contigs'
  -O FILENAME_PREFIX, --output-file-prefix FILENAME_PREFIX
                        A prefix to be used while naming the output files (no
                        file type extensions please; just a prefix).
  -C COLLECTION_NAME, --collection-name COLLECTION_NAME
                        Collection name.
  -b BIN_NAME, --bin-id BIN_NAME
                        Bin name you are interested in.
  -B FILE_PATH, --bin-ids-file FILE_PATH
                        Text file for bins (each line should be a unique bin
                        id).
  --exclude-samples FILE
                        List of samples to exclude for the analysis.
  --include-samples FILE
                        List of samples to include for the analysis.
  --gen-figures         For those of you who wish to dig deeper, a collection
                        of figures could be created to allow you to get
                        insight into how the classification was generated.
                        This is especially useful to identify cases in which
                        you shouldn't trust the classification (for example
                        due to a large number of outliers). NOTICE: if you ask
                        anvi'o to generate these figures then it will
                        significantly extend the execution time. To learn
                        about which figures are created and what they mean,
                        contact your nearest anvi'o developer, because
                        currently it is a well-hidden secret.
  --get-samples-stats-only
                        If you only wish to get statistics regarding the
                        occurence of bins in samples, then use this flag.
                        Especially when dealing with many samples or large
                        genomes, gene stats could be a long time to compute.
                        By using this flag you could save a lot of computation
                        time.
  -W, --overwrite-output-destinations
                        Overwrite if the output files and/or directories
                        exist.
  --alpha NUM, --genome-detection-uncertainty NUM
                        Determines the range of sample detection values that
                        are considered negative, ambiguous or positive. Min of
                        0 and smaller than 0.5, default of 0.25. For exmaple
                        for the default samples with detection below 0.5-0.25
                        = 0.25 will be considered negative (i.e. donot contain
                        the genome), samples with detection between 0.25 and
                        0.75 would be ambiguous (and hence would not be used
                        for the classification), and samples with detection
                        above 0.75 would be considered positive (i.e. contain
                        the genome).
  --outliers-threshold NUM
                        Threshold to use for the outlier detection. The
                        default value is '1.5'. Absolute deviation around the
                        median is used. To read more about the method please
                        refer to: 'How to Detect and Handle Outliers' by Boris
                        Iglewicz and David Hoaglin
                        (doi:10.1016/j.jesp.2013.03.013).
  --zeros-are-outliers  If you want all zero coverage positions to be treated
                        like outliers then use this flag. The reason to treat
                        zero coverage as outliers is because when mapping
                        reads to a reference we could get many zero positions
                        due to accessory genes. These positions then skew the
                        average values that we compute.

ESSENTIAL INPUTS:
  You must supply a merged profile db (along with a matching contigs db)

ESSENTIAL OUTPUTS:
  The outputs of the algorithm are: an anvio additional layers format file
  with the classification information for genes. An anvio samples
  information file with detectino information per sample. In addition, when
  a profile database is given then a gene-coverages, and gene-detection
  tables would also be saved. All files are created with the prefix that is
  provided by the user.

ADDITIONAL STUFF:
  Parameters to provide pre-existing additional layers, samples-information
  files, so that the outputs would be added to these files

PARAMETERS:
  Parameters to determine cut-offs for the gene-classifier

    ]]></help>
    <citations>
        <citation type="doi">10.7717/peerj.1319</citation>
    </citations>
</tool>