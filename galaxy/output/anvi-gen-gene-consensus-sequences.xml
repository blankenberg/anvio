<tool id="anvi_gen_gene_consensus_sequences" name="anvi-gen-gene-consensus-sequences" version="5.2">
    <description>Collapse variability for a set of genes across samples</description>
    <requirements>
        <requirement type="package" version="5.2">anvio</requirement>
    </requirements>
    <stdio>
        <exit_code range="1:" />
    </stdio>
    <version_command>anvi-gen-gene-consensus-sequences --version</version_command>
    <command><![CDATA[
        cp -R '${input_profile_db.extra_files_path}' '${output_profile_db.extra_files_path}'
 && 
cp -R '${input_contigs_db.extra_files_path}' '${output_contigs_db.extra_files_path}'
 &&
 anvi-gen-gene-consensus-sequences
--profile-db '${output_profile_db.extra_files_path}/PROFILE.db'

--contigs-db '${output_contigs_db.extra_files_path}/CONTIGS.db'


#if $str( $gene_caller_ids ):
    --gene-caller-ids '${gene_caller_ids}'
#end if


#if $genes_of_interest:
    --genes-of-interest '${genes_of_interest}'
#end if


#if $samples_of_interest:
    --samples-of-interest '${samples_of_interest}'
#end if


#if $output_file:
    --output-file '${output_file}'
#end if

${tab_delimited}


#if $str( $engine ):
    --engine '${engine}'
#end if

${contigs_mode}

${compress_samples}

&> '${GALAXY_ANVIO_LOG}'

    ]]></command>
    <inputs>
        <param name="input_profile_db" type="data" label="Profile Db" format="anvio_profile_db" optional="False" multiple="False" argument="--profile-db" help="Anvi'o profile database"/>
        <param name="input_contigs_db" type="data" label="Contigs Db" format="anvio_contigs_db" optional="False" multiple="False" argument="--contigs-db" help="Anvi'o contigs database generated by 'anvi-gen-contigs'"/>
        <param name="gene_caller_ids" type="text" label="Gene Caller Ids" value="" optional="True" argument="--gene-caller-ids" help="Gene caller ids. Multiple of them can be declared separated by a delimiter (the default is a comma). In anvi-gen-variability-profile, if you declare nothing you will get all genes matching your other filtering criteria. In other programs, you may get everything, nothing, or an error. It really depends on the situation. Fortunately mistakes are cheap, so it's worth a try."/>
        <param name="genes_of_interest" type="data" label="Genes Of Interest" format="txt" optional="True" multiple="False" argument="--genes-of-interest" help="A file with anvi'o gene caller IDs. There should be only one column in the file, and each line should correspond to a unique gene caller id (without a column header)."/>
        <param name="samples_of_interest" type="data" label="Samples Of Interest" format="txt" optional="True" multiple="False" argument="--samples-of-interest" help="A file with samples names. There should be only one column in the file, and each line should correspond to a unique sample name (without a column header)."/>
        <param name="tab_delimited" type="boolean" label="Tab Delimited" truevalue="--tab-delimited" falsevalue="" checked="False" optional="True" argument="--tab-delimited" help="Use the TAB-delimited format for the output file."/>
        <param name="engine" type="text" label="Engine" value="NT" optional="True" argument="--engine" help="Varaibility engine. The default is '%(default)s'."/>
        <param name="contigs_mode" type="boolean" label="Contigs Mode" truevalue="--contigs-mode" falsevalue="" checked="False" optional="True" argument="--contigs-mode" help="Use this flag to output consensus sequences of contigs, instead of the default, which is genes"/>
        <param name="compress_samples" type="boolean" label="Compress Samples" truevalue="--compress-samples" falsevalue="" checked="" optional="True" argument="--compress-samples" help="Normally all samples with variation will have their own consensus sequence. If this flag is provided, the coverages from each sample of interest will be summed and only a single consenus sequence for each gene/contig will be output."/>
    </inputs>
    <outputs>
        <data name="output_profile_db" format="anvio_profile_db" format_source="input_profile_db" metadata_source="input_profile_db" label="${tool.name} on ${on_string}: Profile Db"/>
        <data name="output_contigs_db" format="anvio_contigs_db" format_source="input_contigs_db" metadata_source="input_contigs_db" label="${tool.name} on ${on_string}: Contigs Db"/>
        <data name="output_file" format="txt" format_source="input_output_file" metadata_source="input_output_file" label="${tool.name} on ${on_string}: Output File"/>
        <data name="GALAXY_ANVIO_LOG" format="txt" label="${tool.name} on ${on_string}: Log"/>
    </outputs>
    <help><![CDATA[
        usage: anvi-gen-gene-consensus-sequences [-h] -p PROFILE_DB -c CONTIGS_DB
                              [--gene-caller-ids GENE_CALLER_IDS]
                              [--genes-of-interest FILE]
                              [--samples-of-interest FILE] [-o FILE_PATH]
                              [--tab-delimited] [--engine ENGINE]
                              [--contigs-mode] [--compress-samples]

Collapse variability for a set of genes across samples

optional arguments:
  -h, --help            show this help message and exit
  -p PROFILE_DB, --profile-db PROFILE_DB
                        Anvi'o profile database
  -c CONTIGS_DB, --contigs-db CONTIGS_DB
                        Anvi'o contigs database generated by 'anvi-gen-
                        contigs'
  --gene-caller-ids GENE_CALLER_IDS
                        Gene caller ids. Multiple of them can be declared
                        separated by a delimiter (the default is a comma). In
                        anvi-gen-variability-profile, if you declare nothing
                        you will get all genes matching your other filtering
                        criteria. In other programs, you may get everything,
                        nothing, or an error. It really depends on the
                        situation. Fortunately mistakes are cheap, so it's
                        worth a try.
  --genes-of-interest FILE
                        A file with anvi'o gene caller IDs. There should be
                        only one column in the file, and each line should
                        correspond to a unique gene caller id (without a
                        column header).
  --samples-of-interest FILE
                        A file with samples names. There should be only one
                        column in the file, and each line should correspond to
                        a unique sample name (without a column header).
  -o FILE_PATH, --output-file FILE_PATH
                        The output file name. The boring default is
                        "genes.fa". You can change the output file format to a
                        TAB-delimited file using teh flag `--tab-delimited`,
                        in which case please do not forget to change the file
                        name, too.
  --tab-delimited       Use the TAB-delimited format for the output file.
  --engine ENGINE       Varaibility engine. The default is 'NT'.
  --contigs-mode        Use this flag to output consensus sequences of
                        contigs, instead of the default, which is genes
  --compress-samples    Normally all samples with variation will have their
                        own consensus sequence. If this flag is provided, the
                        coverages from each sample of interest will be summed
                        and only a single consenus sequence for each
                        gene/contig will be output.

DATABASES:
  Declaring relevant anvi'o databases. First things first.

FOCUS:
  What do we want? A consensus sequence for a gene, or a list of genes. From
  where do we want it? All samples, by default. When do we want it? Whenever
  it is convenient.

OUTPUT:
  Output file and output style

EXTRAS:
  Parameters that will help you to do a very precise analysis. If you
  declare nothing from this bunch, you will get "everything" to play with,
  which is not necessarily a good thing...

    ]]></help>
    <citations>
        <citation type="doi">10.7717/peerj.1319</citation>
        <citation type="bibtex">@ARTICLE{Blankenberg19-anvio,
   author = {Daniel Blankenberg, et al},
   title = {In preparation..},
   }</citation>
    </citations>
</tool>