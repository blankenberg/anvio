<tool id="anvi_import_collection" name="anvi-import-collection" version="5.3">
    <description>Import an external binning result into anvi'o</description>
    <requirements>
        <requirement type="package" version="5.3">anvio</requirement>
    </requirements>
    <stdio>
        <exit_code range="1:" />
    </stdio>
    <version_command>anvi-import-collection --version</version_command>
    <command><![CDATA[
        
    #if $input_contigs_db:
        cp -R '${input_contigs_db.extra_files_path}' '${output_contigs_db.extra_files_path}'
    #else
        echo ''
    #end if
 && 

    #if $input_pan_or_profile_db:
        cp -R '${input_pan_or_profile_db.extra_files_path}' '${output_pan_or_profile_db.extra_files_path}'
    #else
        echo ''
    #end if
 &&
 anvi-import-collection

#if $data:
     '${data}'
#end if

--contigs-db '${output_contigs_db.extra_files_path}/CONTIGS.db'


#if $output_pan_or_profile_db:
    --pan-or-profile-db '${output_pan_or_profile_db.extra_files_path}/${output_pan_or_profile_db.metadata.anvio_basename}'
#end if

--collection-name '${collection_name}'


#if $bins_info:
    --bins-info '${bins_info}'
#end if

${contigs_mode}

&> '${GALAXY_ANVIO_LOG}'

    ]]></command>
    <inputs>
        <param name="data" type="data" label="Data" format="tabular" optional="True" multiple="False" argument="" help="The input file that describes bin IDs for each split or contig."/>
        <param name="input_contigs_db" type="data" label="Contigs Db" format="anvio_contigs_db" optional="True" multiple="False" argument="--contigs-db" help="Anvi'o contigs database generated by 'anvi-gen-contigs'"/>
        <param name="input_pan_or_profile_db" type="data" label="Pan Or Profile Db" format="anvio_profile_db,anvio_pan_db" optional="True" multiple="False" argument="--pan-or-profile-db" help="Anvi'o pan or profile database (and even genes database in appropriate contexts)."/>
        <param name="collection_name" type="text" label="Collection Name" value="" optional="False" argument="--collection-name" help="Collection name."/>
        <param name="bins_info" type="data" label="Bins Info" format="tabular" optional="True" multiple="False" argument="--bins-info" help="Additional information for bins. The file must contain three TAB-delimited columns, where the first one must be a unique bin name, the second should be a 'source', and the last one should be a 7 character HTML color code (i.e., '#424242'). Source column must contain information about the origin of the bin. If these bins are automatically identified by a program like CONCOCT, this column could contain the program name and version. The source information will be associated with the bin in various interfaces so in a sense it is not *that* critical what it says there, but on the other hand it is, becuse we should also think about people who may end up having to work with what we put together later."/>
        <param name="contigs_mode" type="boolean" label="Contigs Mode" truevalue="--contigs-mode" falsevalue="" checked="False" optional="True" argument="--contigs-mode" help="Use this flag if your binning was done on contigs instead of splits. Please refer to the documentation for help."/>
    </inputs>
    <outputs>
        <data name="output_contigs_db" format="anvio_contigs_db" format_source="input_contigs_db" metadata_source="input_contigs_db" label="${tool.name} on ${on_string}: Contigs Db"/>
        <data name="output_pan_or_profile_db" format="anvio_profile_db" format_source="input_pan_or_profile_db" metadata_source="input_pan_or_profile_db" label="${tool.name} on ${on_string}: Pan Or Profile Db"/>
        <data name="GALAXY_ANVIO_LOG" format="txt" label="${tool.name} on ${on_string}: Log"/>
    </outputs>
    <help><![CDATA[
        usage: anvi-import-collection [-h] [-c CONTIGS_DB] [-p PAN_OR_PROFILE_DB] -C
                              COLLECTION_NAME [--bins-info BINS_INFO]
                              [--contigs-mode]
                              TAB DELIMITED FILE

Import an external binning result into anvi'o

positional arguments:
  TAB DELIMITED FILE    The input file that describes bin IDs for each split
                        or contig.

optional arguments:
  -h, --help            show this help message and exit
  -c CONTIGS_DB, --contigs-db CONTIGS_DB
                        Anvi'o contigs database generated by 'anvi-gen-
                        contigs'
  -p PAN_OR_PROFILE_DB, --pan-or-profile-db PAN_OR_PROFILE_DB
                        Anvi'o pan or profile database (and even genes
                        database in appropriate contexts).
  -C COLLECTION_NAME, --collection-name COLLECTION_NAME
                        Collection name.
  --bins-info BINS_INFO
                        Additional information for bins. The file must contain
                        three TAB-delimited columns, where the first one must
                        be a unique bin name, the second should be a 'source',
                        and the last one should be a 7 character HTML color
                        code (i.e., '#424242'). Source column must contain
                        information about the origin of the bin. If these bins
                        are automatically identified by a program like
                        CONCOCT, this column could contain the program name
                        and version. The source information will be associated
                        with the bin in various interfaces so in a sense it is
                        not *that* critical what it says there, but on the
                        other hand it is, becuse we should also think about
                        people who may end up having to work with what we put
                        together later.
  --contigs-mode        Use this flag if your binning was done on contigs
                        instead of splits. Please refer to the documentation
                        for help.

    ]]></help>
    <citations>
        <citation type="doi">10.7717/peerj.1319</citation>
        <citation type="bibtex">@ARTICLE{Blankenberg19-anvio,
   author = {Daniel Blankenberg, et al},
   title = {In preparation..},
   }</citation>
    </citations>
</tool>