<tool id="anvi_get_sequences_for_gene_clusters" name="anvi-get-sequences-for-gene-clusters" version="5.2">
    <description>Do cool stuff with gene clusters in anvi'o pan genomes</description>
    <requirements>
        <requirement type="package" version="5.2">anvio</requirement>
    </requirements>
    <stdio>
        <exit_code range="1:" />
    </stdio>
    <version_command>anvi-get-sequences-for-gene-clusters --version</version_command>
    <command><![CDATA[
        cp -R '${input_pan_db.extra_files_path}' '${output_pan_db.extra_files_path}'
 && 

    #if $input_genomes_storage:
        cp -R '${input_genomes_storage.extra_files_path}' '${output_genomes_storage.extra_files_path}'
    #else
        echo ''
    #end if
 &&
 anvi-get-sequences-for-gene-clusters

#if $output_pan_db:
    --pan-db '${output_pan_db.extra_files_path}/${output_pan_db.metadata.anvio_basename}'
#end if


#if $output_genomes_storage:
    --genomes-storage '${output_genomes_storage.extra_files_path}/${output_genomes_storage.metadata.anvio_basename}'
#end if


#if $output_file:
    --output-file '${output_file}'
#end if

${report_DNA_sequences}


#if $str( $gene_cluster_id ):
    --gene-cluster-id '${gene_cluster_id}'
#end if


#if $gene_cluster_ids_file:
    --gene-cluster-ids-file '${gene_cluster_ids_file}'
#end if


#if $str( $collection_name ):
    --collection-name '${collection_name}'
#end if


#if $str( $bin_id ):
    --bin-id '${bin_id}'
#end if


#if $str( $min_num_genomes_gene_cluster_occurs ):
    --min-num-genomes-gene-cluster-occurs '${min_num_genomes_gene_cluster_occurs}'
#end if


#if $str( $max_num_genomes_gene_cluster_occurs ):
    --max-num-genomes-gene-cluster-occurs '${max_num_genomes_gene_cluster_occurs}'
#end if


#if $str( $min_num_genes_from_each_genome ):
    --min-num-genes-from-each-genome '${min_num_genes_from_each_genome}'
#end if


#if $str( $max_num_genes_from_each_genome ):
    --max-num-genes-from-each-genome '${max_num_genes_from_each_genome}'
#end if


#if $str( $max_num_gene_clusters_missing_from_genome ):
    --max-num-gene-clusters-missing-from-genome '${max_num_gene_clusters_missing_from_genome}'
#end if


#if $str( $min_functional_homogeneity_index ):
    --min-functional-homogeneity-index '${min_functional_homogeneity_index}'
#end if


#if $str( $max_functional_homogeneity_index ):
    --max-functional-homogeneity-index '${max_functional_homogeneity_index}'
#end if


#if $str( $min_geometric_homogeneity_index ):
    --min-geometric-homogeneity-index '${min_geometric_homogeneity_index}'
#end if


#if $str( $max_geometric_homogeneity_index ):
    --max-geometric-homogeneity-index '${max_geometric_homogeneity_index}'
#end if


#if $str( $add_into_items_additional_data_table ):
    --add-into-items-additional-data-table '${add_into_items_additional_data_table}'
#end if

${list_collections}

${list_bins}

${concatenate_gene_clusters}


#if $str( $separator ):
    --separator '${separator}'
#end if


#if $str( $align_with ):
    --align-with '${align_with}'
#end if

${list_aligners}

--just-do-it
&> '${GALAXY_ANVIO_LOG}'

    ]]></command>
    <inputs>
        <param name="input_pan_db" type="data" label="Pan Db" format="anvio_pan_db" optional="False" multiple="False" argument="--pan-db" help="Anvi'o pan database"/>
        <param name="input_genomes_storage" type="data" label="Genomes Storage" format="anvio_genomes_db" optional="True" multiple="False" argument="--genomes-storage" help="Anvi'o genomes storage file"/>
        <param name="report_DNA_sequences" type="boolean" label="Report Dna Sequences" truevalue="--report-DNA-sequences" falsevalue="" checked="False" optional="True" argument="--report-DNA-sequences" help="By default, this program reports amino acid sequences. You can change that behavior and as for DNA sequences instead using this flag."/>
        <param name="gene_cluster_id" type="text" label="Gene Cluster Id" value="" optional="True" argument="--gene-cluster-id" help="Gene cluster ID you are interested in."/>
        <param name="gene_cluster_ids_file" type="data" label="Gene Cluster Ids File" format="txt" optional="True" multiple="False" argument="--gene-cluster-ids-file" help="Text file for gene clusters (each line should contain be a unique gene cluster id)."/>
        <param name="collection_name" type="text" label="Collection Name" value="" optional="True" argument="--collection-name" help="Collection name."/>
        <param name="bin_id" type="text" label="Bin Id" value="" optional="True" argument="--bin-id" help="Bin name you are interested in."/>
        <param name="min_num_genomes_gene_cluster_occurs" type="integer" label="Min Num Genomes Gene Cluster Occurs" value="0" optional="True" argument="--min-num-genomes-gene-cluster-occurs" help="This filter will remove gene clusters from your report. Let's assume you have 100 genomes in your pan genome analysis. You can use this parameter if you want to work only with gene clusters that occur in at least X number of genomes. If you say '--min-num-genomes-gene-cluster-occurs 90', each gene cluster in the analysis will be required at least to appear in 90 genomes. If a gene occurs in less than that number of genomes, it simply will not be reported. This is especially useful for phylogenomic analyses, where you may want to only focus on gene clusters that are prevalent across the set of genomes you wish to analyze."/>
        <param name="max_num_genomes_gene_cluster_occurs" type="integer" label="Max Num Genomes Gene Cluster Occurs" value="9223372036854775807" optional="True" argument="--max-num-genomes-gene-cluster-occurs" help="This filter will remove gene clusters from your report. Let's assume you have 100 genomes in your pan genome analysis. You can use this parameter if you want to work only with gene clusters that occur in at most X number of genomes. If you say '--max-num-genomes-gene-cluster-occurs 1', you will get gene clusters that are singletons. Combining this paramter with --min-num-genomes-gene-cluster-occurs can give you a very precise way to filter your gene clusters."/>
        <param name="min_num_genes_from_each_genome" type="integer" label="Min Num Genes From Each Genome" value="0" optional="True" argument="--min-num-genes-from-each-genome" help="This filter will remove gene clusters from your report. If you say '--min-num-genes-from-each-genome 2', this filter will remove every gene cluster, to which every genome in your analysis contributed less than 2 genes. This can be useful to find out gene clusters with many genes from many genomes (such as conserved multi-copy genes within a clade)."/>
        <param name="max_num_genes_from_each_genome" type="integer" label="Max Num Genes From Each Genome" value="9223372036854775807" optional="True" argument="--max-num-genes-from-each-genome" help="This filter will remove gene clusters from your report. If you say '--max-num-genes-from-each-genome 1', every gene cluster that has more than one gene from any genome that contributes to it will be removed from your analysis. This could be useful to remove gene clusters with paralogs from your report for appropriate phylogenomic analyses. For instance, using '--max-num-genes-from-each-genome 1' and 'min-num-genomes-gene-cluster-occurs X' where X is the total number of your genomes, would give you the single-copy gene cluters in your pan genome."/>
        <param name="max_num_gene_clusters_missing_from_genome" type="integer" label="Max Num Gene Clusters Missing From Genome" value="0" optional="True" argument="--max-num-gene-clusters-missing-from-genome" help="This filter will remove genomes from your report. If you have a list of gene cluster names, you can use this parameter to omit any genome from your report if it is missing more than a number of genes you desire. For instance, if you have 100 genomes in your pan genome, and you are interested in working only with genomes that have all 5 specific gene clusters of your choice, you can use '--max-num-gene-clusters-missing-from-genome 4' to remove remove the bins that are missing more than 4 of those 5 genes. This is especially useful for phylogenomic analyses. Parameter 0 will remove any genome that is missing any of the genes."/>
        <param name="min_functional_homogeneity_index" type="float" label="Min Functional Homogeneity Index" value="-1" optional="True" argument="--min-functional-homogeneity-index" help="This filter will remove genoe clusters from your report. If you say '--min-functional-homogeneity-index 0.3', every gene cluster with a functional homogeneity index less than 0.3 will be removed from your analysis. This can be useful if you only want to look at gene clusters that are highly conserved in resulting funciton"/>
        <param name="max_functional_homogeneity_index" type="float" label="Max Functional Homogeneity Index" value="1" optional="True" argument="--max-functional-homogeneity-index" help="This filter will remove genoe clusters from your report. If you say '--max-functional-homogeneity-index 0.5', every gene cluster with a functional homogeneity index greater than 0.5 will be removed from your analysis. This can be useful if you only want to look at gene clusters that don't seem to be functionally conserved"/>
        <param name="min_geometric_homogeneity_index" type="float" label="Min Geometric Homogeneity Index" value="-1" optional="True" argument="--min-geometric-homogeneity-index" help="This filter will remove genoe clusters from your report. If you say '--min-geometric-homogeneity-index 0.3', every gene cluster with a geometric homogeneity index less than 0.3 will be removed from your analysis. This can be useful if you only want to look at gene clusters that are highly conserved in geometric configuration"/>
        <param name="max_geometric_homogeneity_index" type="float" label="Max Geometric Homogeneity Index" value="1" optional="True" argument="--max-geometric-homogeneity-index" help="This filter will remove genoe clusters from your report. If you say '--max-geometric-homogeneity-index 0.5', every gene cluster with a geometric homogeneity index greater than 0.5 will be removed from your analysis. This can be useful if you only want to look at gene clusters that have many not be as conserved as others"/>
        <param name="add_into_items_additional_data_table" type="text" label="Add Into Items Additional Data Table" value="" optional="True" argument="--add-into-items-additional-data-table" help="If you use any of the filters, and would like to add the resulting item names into the items additional data table of your database, you can use this parameter. You will need to give a name for these results to be saved. If the given name is already in the items additoinal data table, its contents will be replaced with the new one. Then you can run anvi-interactive or anvi-display-pan to 'see' the results of your filters."/>
        <param name="list_collections" type="boolean" label="List Collections" truevalue="--list-collections" falsevalue="" checked="False" optional="True" argument="--list-collections" help="Show available collections and exit."/>
        <param name="list_bins" type="boolean" label="List Bins" truevalue="--list-bins" falsevalue="" checked="False" optional="True" argument="--list-bins" help="List available bins in a collection and exit."/>
        <param name="concatenate_gene_clusters" type="boolean" label="Concatenate Gene Clusters" truevalue="--concatenate-gene-clusters" falsevalue="" checked="False" optional="True" argument="--concatenate-gene-clusters" help="Concatenate output gene clusters in the same order to create a multi-gene alignment output that is suitable for phylogenomic analyses."/>
        <param name="separator" type="text" label="Separator" value="" optional="True" argument="--separator" help="Characters to separate things (the default is whatever is most suitable)."/>
        <param name="align_with" type="text" label="Align With" value="" optional="True" argument="--align-with" help="The multiple sequnce alignment program to use when multiple seqeunce alignment is necessary. To see all available optons, use the flag `--list-aligners`."/>
        <param name="list_aligners" type="boolean" label="List Aligners" truevalue="--list-aligners" falsevalue="" checked="False" optional="True" argument="--list-aligners" help="Show available software for multiple sequence alignment."/>
    </inputs>
    <outputs>
        <data name="output_pan_db" format="anvio_pan_db" format_source="input_pan_db" metadata_source="input_pan_db" label="${tool.name} on ${on_string}: Pan Db"/>
        <data name="output_genomes_storage" format="anvio_genomes_db" format_source="input_genomes_storage" metadata_source="input_genomes_storage" label="${tool.name} on ${on_string}: Genomes Storage"/>
        <data name="output_file" format="fasta" format_source="input_output_file" metadata_source="input_output_file" label="${tool.name} on ${on_string}: Output File"/>
        <data name="GALAXY_ANVIO_LOG" format="txt" label="${tool.name} on ${on_string}: Log"/>
    </outputs>
    <help><![CDATA[
        usage: anvi-get-sequences-for-gene-clusters [-h] -p PAN_DB [-g GENOMES_STORAGE] [-o FASTA]
                              [--report-DNA-sequences]
                              [--gene-cluster-id GENE_CLUSTER_ID]
                              [--gene-cluster-ids-file FILE_PATH]
                              [-C COLLECTION_NAME] [-b BIN_NAME]
                              [--min-num-genomes-gene-cluster-occurs INTEGER]
                              [--max-num-genomes-gene-cluster-occurs INTEGER]
                              [--min-num-genes-from-each-genome INTEGER]
                              [--max-num-genes-from-each-genome INTEGER]
                              [--max-num-gene-clusters-missing-from-genome INTEGER]
                              [--min-functional-homogeneity-index FLOAT]
                              [--max-functional-homogeneity-index FLOAT]
                              [--min-geometric-homogeneity-index FLOAT]
                              [--max-geometric-homogeneity-index FLOAT]
                              [--add-into-items-additional-data-table NAME]
                              [--list-collections] [--list-bins]
                              [--concatenate-gene-clusters]
                              [--separator STRING] [--align-with ALIGNER]
                              [--list-aligners] [--just-do-it]

Do cool stuff with gene clusters in anvi'o pan genomes

optional arguments:
  -h, --help            show this help message and exit
  -p PAN_DB, --pan-db PAN_DB
                        Anvi'o pan database
  -g GENOMES_STORAGE, --genomes-storage GENOMES_STORAGE
                        Anvi'o genomes storage file
  -o FASTA, --output-file FASTA
                        File path to store results.
  --report-DNA-sequences
                        By default, this program reports amino acid sequences.
                        You can change that behavior and as for DNA sequences
                        instead using this flag.
  --gene-cluster-id GENE_CLUSTER_ID
                        Gene cluster ID you are interested in.
  --gene-cluster-ids-file FILE_PATH
                        Text file for gene clusters (each line should contain
                        be a unique gene cluster id).
  -C COLLECTION_NAME, --collection-name COLLECTION_NAME
                        Collection name.
  -b BIN_NAME, --bin-id BIN_NAME
                        Bin name you are interested in.
  --min-num-genomes-gene-cluster-occurs INTEGER
                        This filter will remove gene clusters from your
                        report. Let's assume you have 100 genomes in your pan
                        genome analysis. You can use this parameter if you
                        want to work only with gene clusters that occur in at
                        least X number of genomes. If you say '--min-num-
                        genomes-gene-cluster-occurs 90', each gene cluster in
                        the analysis will be required at least to appear in 90
                        genomes. If a gene occurs in less than that number of
                        genomes, it simply will not be reported. This is
                        especially useful for phylogenomic analyses, where you
                        may want to only focus on gene clusters that are
                        prevalent across the set of genomes you wish to
                        analyze.
  --max-num-genomes-gene-cluster-occurs INTEGER
                        This filter will remove gene clusters from your
                        report. Let's assume you have 100 genomes in your pan
                        genome analysis. You can use this parameter if you
                        want to work only with gene clusters that occur in at
                        most X number of genomes. If you say '--max-num-
                        genomes-gene-cluster-occurs 1', you will get gene
                        clusters that are singletons. Combining this paramter
                        with --min-num-genomes-gene-cluster-occurs can give
                        you a very precise way to filter your gene clusters.
  --min-num-genes-from-each-genome INTEGER
                        This filter will remove gene clusters from your
                        report. If you say '--min-num-genes-from-each-genome
                        2', this filter will remove every gene cluster, to
                        which every genome in your analysis contributed less
                        than 2 genes. This can be useful to find out gene
                        clusters with many genes from many genomes (such as
                        conserved multi-copy genes within a clade).
  --max-num-genes-from-each-genome INTEGER
                        This filter will remove gene clusters from your
                        report. If you say '--max-num-genes-from-each-genome
                        1', every gene cluster that has more than one gene
                        from any genome that contributes to it will be removed
                        from your analysis. This could be useful to remove
                        gene clusters with paralogs from your report for
                        appropriate phylogenomic analyses. For instance, using
                        '--max-num-genes-from-each-genome 1' and 'min-num-
                        genomes-gene-cluster-occurs X' where X is the total
                        number of your genomes, would give you the single-copy
                        gene cluters in your pan genome.
  --max-num-gene-clusters-missing-from-genome INTEGER
                        This filter will remove genomes from your report. If
                        you have a list of gene cluster names, you can use
                        this parameter to omit any genome from your report if
                        it is missing more than a number of genes you desire.
                        For instance, if you have 100 genomes in your pan
                        genome, and you are interested in working only with
                        genomes that have all 5 specific gene clusters of your
                        choice, you can use '--max-num-gene-clusters-missing-
                        from-genome 4' to remove remove the bins that are
                        missing more than 4 of those 5 genes. This is
                        especially useful for phylogenomic analyses. Parameter
                        0 will remove any genome that is missing any of the
                        genes.
  --min-functional-homogeneity-index FLOAT
                        This filter will remove genoe clusters from your
                        report. If you say '--min-functional-homogeneity-index
                        0.3', every gene cluster with a functional homogeneity
                        index less than 0.3 will be removed from your
                        analysis. This can be useful if you only want to look
                        at gene clusters that are highly conserved in
                        resulting funciton
  --max-functional-homogeneity-index FLOAT
                        This filter will remove genoe clusters from your
                        report. If you say '--max-functional-homogeneity-index
                        0.5', every gene cluster with a functional homogeneity
                        index greater than 0.5 will be removed from your
                        analysis. This can be useful if you only want to look
                        at gene clusters that don't seem to be functionally
                        conserved
  --min-geometric-homogeneity-index FLOAT
                        This filter will remove genoe clusters from your
                        report. If you say '--min-geometric-homogeneity-index
                        0.3', every gene cluster with a geometric homogeneity
                        index less than 0.3 will be removed from your
                        analysis. This can be useful if you only want to look
                        at gene clusters that are highly conserved in
                        geometric configuration
  --max-geometric-homogeneity-index FLOAT
                        This filter will remove genoe clusters from your
                        report. If you say '--max-geometric-homogeneity-index
                        0.5', every gene cluster with a geometric homogeneity
                        index greater than 0.5 will be removed from your
                        analysis. This can be useful if you only want to look
                        at gene clusters that have many not be as conserved as
                        others
  --add-into-items-additional-data-table NAME
                        If you use any of the filters, and would like to add
                        the resulting item names into the items additional
                        data table of your database, you can use this
                        parameter. You will need to give a name for these
                        results to be saved. If the given name is already in
                        the items additoinal data table, its contents will be
                        replaced with the new one. Then you can run anvi-
                        interactive or anvi-display-pan to 'see' the results
                        of your filters.
  --list-collections    Show available collections and exit.
  --list-bins           List available bins in a collection and exit.
  --concatenate-gene-clusters
                        Concatenate output gene clusters in the same order to
                        create a multi-gene alignment output that is suitable
                        for phylogenomic analyses.
  --separator STRING    Characters to separate things (the default is whatever
                        is most suitable).
  --align-with ALIGNER  The multiple sequnce alignment program to use when
                        multiple seqeunce alignment is necessary. To see all
                        available optons, use the flag `--list-aligners`.
  --list-aligners       Show available software for multiple sequence
                        alignment.
  --just-do-it          Don't bother me with questions or warnings, just do
                        it.

INPUT FILES:
  Input files from the pangenome analysis.

OUTPUT:
  You get to chose an output file name to report things. The default will be
  an ugly name. So, be explicit.

SELECTION:
  Which gene clusters should be reported. You can ask for a single gene
  cluster, or multiple ones listed in a file, or you can use a collection
  and bin name to list gene clusters of interest. If you give nothing, this
  program will export alignments for every single gene cluster found in the
  profile database (and this is called 'customer service').

ADVANCED FILTERS:
  If you are here you must be looking for ways to specify exactly what you
  want from that database of gene clusters. These filters will be applied to
  what your previous selections reported.

OTHER STUFF:
  Yes. Stuff that are not like the ones above.

CONCATENATED OUTPUT:
  Concatenated output for phylogenomics.

TOTALLY IRRELEVANT:
  Just in case you need it.

    ]]></help>
    <citations>
        <citation type="doi">10.7717/peerj.1319</citation>
        <citation type="bibtex">@ARTICLE{Blankenberg19-anvio,
   author = {Daniel Blankenberg, et al},
   title = {In preparation..},
   }</citation>
    </citations>
</tool>