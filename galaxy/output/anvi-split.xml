<tool id="anvi_split" name="anvi-split" version="5.3.0" tool_type="default">
    <description>Split an anvi'o profile into smaller profiles. This is usually great when                                                  you want to share a subset of an anvi'o profile. You give this guy an anvi'o                                                  profile databsae, a contigs database, and a collection id, and it gives                                                  you back directories of profiles for each bin that can be treated as                                                  individual anvi'o profiles.</description>
    <requirements>
        <requirement type="package" version="5.3.0">anvio</requirement>
    </requirements>
    <stdio>
        <exit_code range="1:" />
    </stdio>
    <version_command>anvi-split --version</version_command>
    <command><![CDATA[
        cp -R '${input_profile_db.extra_files_path}' '${output_profile_db.extra_files_path}'
 && 
cp -R '${input_contigs_db.extra_files_path}' '${output_contigs_db.extra_files_path}'
 &&
 anvi-split
--profile-db '${output_profile_db.extra_files_path}/PROFILE.db'

--contigs-db '${output_contigs_db.extra_files_path}/CONTIGS.db'


#if $str( $collection_name ):
    --collection-name '${collection_name}'
#end if


#if $str( $bin_id ):
    --bin-id '${bin_id}'
#end if


#if $output_dir:
    --output-dir '${output_dir.extra_files_path}'
#end if

${list_collections}

${skip_hierarchical_clustering}

${skip_variability_tables}

${compress_auxiliary_data}

${enforce_hierarchical_clustering}


#if $str( $distance ):
    --distance '${distance}'
#end if


#if $str( $linkage ):
    --linkage '${linkage}'
#end if

&> '${GALAXY_ANVIO_LOG}'

    ]]></command>
    <inputs>
        <param name="input_profile_db" type="data" label="Profile Db" format="anvio_profile_db" optional="False" multiple="False" argument="--profile-db" help="Anvi'o profile database"/>
        <param name="input_contigs_db" type="data" label="Contigs Db" format="anvio_contigs_db" optional="False" multiple="False" argument="--contigs-db" help="Anvi'o contigs database generated by 'anvi-gen-contigs'"/>
        <param name="collection_name" type="text" label="Collection Name" value="" optional="True" argument="--collection-name" help="Collection name."/>
        <param name="bin_id" type="text" label="Bin Id" value="" optional="True" argument="--bin-id" help="Bin name you are interested in."/>
        <param name="list_collections" type="boolean" label="List Collections" truevalue="--list-collections" falsevalue="" checked="False" optional="True" argument="--list-collections" help="Show available collections and exit."/>
        <param name="skip_hierarchical_clustering" type="boolean" label="Skip Hierarchical Clustering" truevalue="--skip-hierarchical-clustering" falsevalue="" checked="False" optional="True" argument="--skip-hierarchical-clustering" help="If you are not planning to use the interactive interface (or if you have other means to add a tree of contigs in the database) you may skip the step where hierarchical clustering of your items are preformed based on default clustering recipes matching to your database type."/>
        <param name="skip_variability_tables" type="boolean" label="Skip Variability Tables" truevalue="--skip-variability-tables" falsevalue="" checked="False" optional="True" argument="--skip-variability-tables" help="Processing variability tables in profile databse might take a very very long time. With this flag you will be asking anvi'o to skip them."/>
        <param name="compress_auxiliary_data" type="boolean" label="Compress Auxiliary Data" truevalue="--compress-auxiliary-data" falsevalue="" checked="False" optional="True" argument="--compress-auxiliary-data" help="When declared, the auxiliary data file in the resulting output will be compressed. This saves space, but it takes long. Also, if you are planning to compress the entire later using GZIP, it is even useless to do. But you are the boss!"/>
        <param name="enforce_hierarchical_clustering" type="boolean" label="Enforce Hierarchical Clustering" truevalue="--enforce-hierarchical-clustering" falsevalue="" checked="False" optional="True" argument="--enforce-hierarchical-clustering" help="If you have more than 25,000 splits in your merged profile, anvi-merge will automatically skip the hierarchical clustering of splits (by setting --skip-hierarchical-clustering flag on). This is due to the fact that computational time required for hierarchical clustering increases exponentially with the number of items being clustered. Based on our experience we decided that 25,000 splits is about the maximum we should try. However, this is not a theoretical limit, and you can overwrite this heuristic by using this flag, which would tell anvi'o to attempt to cluster splits regardless."/>
        <param name="distance" type="text" label="Distance" value="" optional="True" argument="--distance" help='The distance metric for the hierarchical clustering. If you do not use this flag, the default distance metric will be used for each clustering configuration which is "euclidean".'/>
        <param name="linkage" type="text" label="Linkage" value="" optional="True" argument="--linkage" help="The same story with the `--distance`, except, the system default for this one is ward."/>
    </inputs>
    <outputs>
        <data name="output_profile_db" format="anvio_profile_db" format_source="input_profile_db" metadata_source="input_profile_db" label="${tool.name} on ${on_string}: Profile Db"/>
        <data name="output_contigs_db" format="anvio_contigs_db" format_source="input_contigs_db" metadata_source="input_contigs_db" label="${tool.name} on ${on_string}: Contigs Db"/>
        <data name="output_dir" format="anvio_profile_db" format_source="input_output_dir" metadata_source="input_output_dir" label="${tool.name} on ${on_string}: Output Dir"/>
        <data name="GALAXY_ANVIO_LOG" format="txt" label="${tool.name} on ${on_string}: Log"/>
    </outputs>
    <help><![CDATA[
        usage: anvi-split [-h] -p PROFILE_DB -c CONTIGS_DB
                              [-C COLLECTION_NAME] [-b BIN_NAME] [-o DIR_PATH]
                              [--list-collections]
                              [--skip-hierarchical-clustering]
                              [--skip-variability-tables]
                              [--compress-auxiliary-data]
                              [--enforce-hierarchical-clustering]
                              [--distance DISTANCE_METRIC]
                              [--linkage LINKAGE_METHOD]

Split an anvi'o profile into smaller profiles. This is usually great when you
want to share a subset of an anvi'o profile. You give this guy an anvi'o
profile databsae, a contigs database, and a collection id, and it gives you
back directories of profiles for each bin that can be treated as individual
anvi'o profiles.

optional arguments:
  -h, --help            show this help message and exit
  -p PROFILE_DB, --profile-db PROFILE_DB
                        Anvi'o profile database
  -c CONTIGS_DB, --contigs-db CONTIGS_DB
                        Anvi'o contigs database generated by 'anvi-gen-
                        contigs'
  -C COLLECTION_NAME, --collection-name COLLECTION_NAME
                        Collection name.
  -b BIN_NAME, --bin-id BIN_NAME
                        Bin name you are interested in.
  -o DIR_PATH, --output-dir DIR_PATH
                        Directory path for output files
  --list-collections    Show available collections and exit.
  --skip-hierarchical-clustering
                        If you are not planning to use the interactive
                        interface (or if you have other means to add a tree of
                        contigs in the database) you may skip the step where
                        hierarchical clustering of your items are preformed
                        based on default clustering recipes matching to your
                        database type.
  --skip-variability-tables
                        Processing variability tables in profile databse might
                        take a very very long time. With this flag you will be
                        asking anvi'o to skip them.
  --compress-auxiliary-data
                        When declared, the auxiliary data file in the
                        resulting output will be compressed. This saves space,
                        but it takes long. Also, if you are planning to
                        compress the entire later using GZIP, it is even
                        useless to do. But you are the boss!
  --enforce-hierarchical-clustering
                        If you have more than 25,000 splits in your merged
                        profile, anvi-merge will automatically skip the
                        hierarchical clustering of splits (by setting --skip-
                        hierarchical-clustering flag on). This is due to the
                        fact that computational time required for hierarchical
                        clustering increases exponentially with the number of
                        items being clustered. Based on our experience we
                        decided that 25,000 splits is about the maximum we
                        should try. However, this is not a theoretical limit,
                        and you can overwrite this heuristic by using this
                        flag, which would tell anvi'o to attempt to cluster
                        splits regardless.
  --distance DISTANCE_METRIC
                        The distance metric for the hierarchical clustering.
                        If you do not use this flag, the default distance
                        metric will be used for each clustering configuration
                        which is "euclidean".
  --linkage LINKAGE_METHOD
                        The same story with the `--distance`, except, the
                        system default for this one is ward.

DATABASES:
  Declaring relevant anvi'o databases. First things first.

COLLECTION:
  You should provide a valid collection name. If you do not provide bin
  names, the program will generate an output for each bin in your collection
  separately.

OUTPUT:
  Where do we want the resulting split profiles to be stored.

EXTRAS:
  Stuff that you rarely need, but you really really need when the time
  comes. Following parameters will aply to each of the resulting anvi'o
  profile that will be split from the mother anvi'o profile.

    ]]></help>
    <citations>
        <citation type="doi">10.7717/peerj.1319</citation>
        <citation type="bibtex">@ARTICLE{Blankenberg19-anvio,
   author = {Daniel Blankenberg, et al},
   title = {In preparation..},
   }</citation>
    </citations>
</tool>