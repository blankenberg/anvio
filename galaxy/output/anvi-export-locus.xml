<tool id="anvi_export_locus" name="anvi-export-locus" version="5.3.0" tool_type="default">
    <description>This program helps you cut a 'locus' from a larger context. Anvi'o does this by                                                   starting from one gene, and extending its selection based on how many genes you                                                   want from its upstream or downstream in the contig its found. The first gene anvi'o                                                   focuses on is defined by you: you can either use a function name in any of the functional                                                   annotation databases or default or user-defined HMMs, or use a gene callers ID. If                                                   everything goes alright, you will get a separate contigs database for every matching                                                   gene anvi'o found in your master contigs database. Enjoy your mini contigs databases.</description>
    <requirements>
        <requirement type="package" version="5.3.0">anvio</requirement>
    </requirements>
    <stdio>
        <exit_code range="1:" />
    </stdio>
    <version_command>anvi-export-locus --version</version_command>
    <command><![CDATA[
        cp -R '${input_contigs_db.extra_files_path}' '${output_contigs_db.extra_files_path}'
 && 
mkdir ${output_file_prefix.extra_files_path}
 &&
 anvi-export-locus
--contigs-db '${output_contigs_db.extra_files_path}/CONTIGS.db'

--num-genes '${num_genes}'


#if $str( $search_term ):
    --search-term '${search_term}'
#end if


#if $str( $gene_caller_ids ):
    --gene-caller-ids '${gene_caller_ids}'
#end if


#if $str( $delimiter ):
    --delimiter '${delimiter}'
#end if


#if $output_dir:
    --output-dir '${output_dir.extra_files_path}'
#end if

--output-file-prefix 'output_file_prefix'

${separate_fasta}

${use_hmm}


#if $str( $hmm_sources ):
    --hmm-sources '${hmm_sources}'
#end if

${list_hmm_sources}

${overwrite_output_destinations}

${remove_partial_hits}

${never_reverse_complement}

&> '${GALAXY_ANVIO_LOG}'

 &&
 ( cp output_file_prefix* '${output_file_prefix.extra_files_path}/' || echo '' )
    ]]></command>
    <inputs>
        <param name="input_contigs_db" type="data" label="Contigs Db" format="anvio_contigs_db" optional="False" multiple="False" argument="--contigs-db" help="Anvi'o contigs database generated by 'anvi-gen-contigs'"/>
        <param name="num_genes" type="text" label="Num Genes" value="" optional="False" argument="--num-genes" help='For each match (to the function, or HMM that was searched) a sequence which includes a block of genes will be saved. The block could include either genes only in the forward direction of the gene (defined according to the direction of transcription of the gene) or reverse or both. If you wish to get both direction use a comma (no spaces) to define the block For example, "-n 4,5" will give you four genes before and five genes after. Whereas, "-n 5" will give you five genes after (in addition to the gene that matched). To get only genes preceeding the match use "-n 5,0". If the number of genes requested exceeds the length of the contig, then the output will include the sequence until the end of the contig.'/>
        <param name="search_term" type="text" label="Search Term" value="" optional="True" argument="--search-term" help="Search term."/>
        <param name="gene_caller_ids" type="text" label="Gene Caller Ids" value="" optional="True" argument="--gene-caller-ids" help="Gene caller ids. Multiple of them can be declared separated by a delimiter (the default is a comma). In anvi-gen-variability-profile, if you declare nothing you will get all genes matching your other filtering criteria. In other programs, you may get everything, nothing, or an error. It really depends on the situation. Fortunately mistakes are cheap, so it's worth a try."/>
        <param name="delimiter" type="text" label="Delimiter" value="," optional="True" argument="--delimiter" help="The delimiter to parse multiple input terms. The default is '%(default)s'."/>
        <param name="separate_fasta" type="boolean" label="Separate Fasta" truevalue="--separate-fasta" falsevalue="" checked="False" optional="True" argument="--separate-fasta" help="Split each match to a separate FASTA file."/>
        <param name="use_hmm" type="boolean" label="Use Hmm" truevalue="--use-hmm" falsevalue="" checked="False" optional="True" argument="--use-hmm" help="Use HMM hits instead of functional annotations. If you choose this option, you must also say which HMM source to use."/>
        <param name="hmm_sources" type="text" label="Hmm Sources" value="" optional="True" argument="--hmm-sources" help="Get sequences for a specific list of HMM sources. You can list one or more sources by separating them from each other with a comma character (i.e., '--hmm-sources source_1,source_2,source_3'). If you would like to see a list of available sources in the contigs database, run this program with '--list-hmm-sources' flag."/>
        <param name="list_hmm_sources" type="boolean" label="List Hmm Sources" truevalue="--list-hmm-sources" falsevalue="" checked="False" optional="True" argument="--list-hmm-sources" help="List available HMM sources in the contigs database and quit."/>
        <param name="overwrite_output_destinations" type="boolean" label="Overwrite Output Destinations" truevalue="--overwrite-output-destinations" falsevalue="" checked="False" optional="True" argument="--overwrite-output-destinations" help="Overwrite if the output files and/or directories exist."/>
        <param name="remove_partial_hits" type="boolean" label="Remove Partial Hits" truevalue="--remove-partial-hits" falsevalue="" checked="False" optional="True" argument="--remove-partial-hits" help="By default anvi'o will return hits even if they are partial. Declaring this flag will make anvi'o filter all hits that are partial. Partial hits are hits in which you asked for n1 genes before and n2 genes after the gene that matched the search criteria but the search hits the end of the contig before finding the number of genes that you asked."/>
        <param name="never_reverse_complement" type="boolean" label="Never Reverse Complement" truevalue="--never-reverse-complement" falsevalue="" checked="False" optional="True" argument="--never-reverse-complement" help="By default, if a gene that is found by the search criteria is reverse in it's direction, then the sequence of the entire locus is reversed before it is saved to the output. If you wish to prevent this behavior then use the flag --never-reverse-complement."/>
    </inputs>
    <outputs>
        <data name="output_contigs_db" format="anvio_contigs_db" format_source="input_contigs_db" metadata_source="input_contigs_db" label="${tool.name} on ${on_string}: Contigs Db"/>
        <data name="output_dir" format="anvio_profile_db" format_source="input_output_dir" metadata_source="input_output_dir" label="${tool.name} on ${on_string}: Output Dir"/>
        <data name="output_file_prefix" format="anvio_composite" format_source="input_output_file_prefix" metadata_source="input_output_file_prefix" label="${tool.name} on ${on_string}: Output File Prefix"/>
        <data name="GALAXY_ANVIO_LOG" format="txt" label="${tool.name} on ${on_string}: Log"/>
    </outputs>
    <help><![CDATA[
        usage: anvi-export-locus [-h] -c CONTIGS_DB -n NUM_GENES [-s SEARCH_TERM]
                              [--gene-caller-ids GENE_CALLER_IDS]
                              [--delimiter CHAR] [-o DIR_PATH] -O
                              FILENAME_PREFIX [--separate-fasta] [--use-hmm]
                              [--hmm-sources SOURCE NAME] [-l] [-W]
                              [--remove-partial-hits]
                              [--never-reverse-complement]

This program helps you cut a 'locus' from a larger context. Anvi'o does this
by starting from one gene, and extending its selection based on how many genes
you want from its upstream or downstream in the contig its found. The first
gene anvi'o focuses on is defined by you: you can either use a function name
in any of the functional annotation databases or default or user-defined HMMs,
or use a gene callers ID. If everything goes alright, you will get a separate
contigs database for every matching gene anvi'o found in your master contigs
database. Enjoy your mini contigs databases.

optional arguments:
  -h, --help            show this help message and exit
  -c CONTIGS_DB, --contigs-db CONTIGS_DB
                        Anvi'o contigs database generated by 'anvi-gen-
                        contigs'
  -n NUM_GENES, --num-genes NUM_GENES
                        For each match (to the function, or HMM that was
                        searched) a sequence which includes a block of genes
                        will be saved. The block could include either genes
                        only in the forward direction of the gene (defined
                        according to the direction of transcription of the
                        gene) or reverse or both. If you wish to get both
                        direction use a comma (no spaces) to define the block
                        For example, "-n 4,5" will give you four genes before
                        and five genes after. Whereas, "-n 5" will give you
                        five genes after (in addition to the gene that
                        matched). To get only genes preceeding the match use
                        "-n 5,0". If the number of genes requested exceeds the
                        length of the contig, then the output will include the
                        sequence until the end of the contig.
  -s SEARCH_TERM, --search-term SEARCH_TERM
                        Search term.
  --gene-caller-ids GENE_CALLER_IDS
                        Gene caller ids. Multiple of them can be declared
                        separated by a delimiter (the default is a comma). In
                        anvi-gen-variability-profile, if you declare nothing
                        you will get all genes matching your other filtering
                        criteria. In other programs, you may get everything,
                        nothing, or an error. It really depends on the
                        situation. Fortunately mistakes are cheap, so it's
                        worth a try.
  --delimiter CHAR      The delimiter to parse multiple input terms. The
                        default is ','.
  -o DIR_PATH, --output-dir DIR_PATH
                        Directory path for output files
  -O FILENAME_PREFIX, --output-file-prefix FILENAME_PREFIX
                        A prefix to be used while naming the output files (no
                        file type extensions please; just a prefix).
  --separate-fasta      Split each match to a separate FASTA file.
  --use-hmm             Use HMM hits instead of functional annotations. If you
                        choose this option, you must also say which HMM source
                        to use.
  --hmm-sources SOURCE NAME
                        Get sequences for a specific list of HMM sources. You
                        can list one or more sources by separating them from
                        each other with a comma character (i.e., '--hmm-
                        sources source_1,source_2,source_3'). If you would
                        like to see a list of available sources in the contigs
                        database, run this program with '--list-hmm-sources'
                        flag.
  -l, --list-hmm-sources
                        List available HMM sources in the contigs database and
                        quit.
  -W, --overwrite-output-destinations
                        Overwrite if the output files and/or directories
                        exist.
  --remove-partial-hits
                        By default anvi'o will return hits even if they are
                        partial. Declaring this flag will make anvi'o filter
                        all hits that are partial. Partial hits are hits in
                        which you asked for n1 genes before and n2 genes after
                        the gene that matched the search criteria but the
                        search hits the end of the contig before finding the
                        number of genes that you asked.
  --never-reverse-complement
                        By default, if a gene that is found by the search
                        criteria is reverse in it's direction, then the
                        sequence of the entire locus is reversed before it is
                        saved to the output. If you wish to prevent this
                        behavior then use the flag --never-reverse-complement.

Additional essential INPUT - OPTION 1:
  Search according to either HMM or functional annotations

Additional essential INPUT - OPTION 2:
  Search specific gene id's

THE OUTPUT:
  Where should the output go. It will be one FASTA file with all matches or
  one FASTA per match (see --separate-fasta)

ADDITIONAL STUFF:
  Flags and parameters you can set according to your need

    ]]></help>
    <citations>
        <citation type="doi">10.7717/peerj.1319</citation>
        <citation type="bibtex">@ARTICLE{Blankenberg19-anvio,
   author = {Daniel Blankenberg, et al},
   title = {In preparation..},
   }</citation>
    </citations>
</tool>