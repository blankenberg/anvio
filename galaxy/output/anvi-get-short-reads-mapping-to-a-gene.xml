<tool id="anvi_get_short_reads_mapping_to_a_gene" name="anvi-get-short-reads-mapping-to-a-gene" version="5.3">
    <description>Access reads in contigs and positions in a BAM file</description>
    <requirements>
        <requirement type="package" version="5.3">anvio</requirement>
    </requirements>
    <stdio>
        <exit_code range="1:" />
    </stdio>
    <version_command>anvi-get-short-reads-mapping-to-a-gene --version</version_command>
    <command><![CDATA[
        
        #for $gxy_i, $input_galaxy_bam in enumerate( $input_files ):
        #if $gxy_i != 0:
            &&
        #end if
        ln -s '${input_galaxy_bam}' '${gxy_i}_input_files.bam' && ln -s '${input_galaxy_bam.metadata.bam_index}' '${gxy_i}_input_files.bam.bai'
        #end for
        
 && 
cp -R '${input_contigs_db.extra_files_path}' '${output_contigs_db.extra_files_path}'
 &&
 anvi-get-short-reads-mapping-to-a-gene

        #for $gxy_i, $input_galaxy_bam in enumerate( $input_files ):
        --input-files '${gxy_i}_input_files.bam'
        #end for
        

--contigs-db '${output_contigs_db.extra_files_path}/CONTIGS.db'

--gene-caller-id '${gene_caller_id}'

--output-file '${output_file}'


#if $str( $leeway ):
    --leeway '${leeway}'
#end if

&> '${GALAXY_ANVIO_LOG}'

    ]]></command>
    <inputs>
        <param name="input_files" type="data" label="Input Files" format="bam" optional="False" multiple="True" argument="--input-files" help="Sorted and indexed BAM files to analyze. It is essential that all BAM files must be the result of mappings against the same contigs."/>
        <param name="input_contigs_db" type="data" label="Contigs Db" format="anvio_contigs_db" optional="False" multiple="False" argument="--contigs-db" help="Anvi'o contigs database generated by 'anvi-gen-contigs'"/>
        <param name="gene_caller_id" type="integer" label="Gene Caller Id" value="" optional="False" argument="--gene-caller-id" help="A single gene id."/>
        <param name="leeway" type="integer" label="Leeway" value="100" optional="True" argument="--leeway" help="The minimum number of nucleotides for a given short read mapping into the gene context for it to be reported. You must consider the length of your short reads, as well as the length of the gene you are targeting. The default is %(default)d nts."/>
    </inputs>
    <outputs>
        <data name="output_contigs_db" format="anvio_contigs_db" format_source="input_contigs_db" metadata_source="input_contigs_db" label="${tool.name} on ${on_string}: Contigs Db"/>
        <data name="output_file" format="txt" format_source="input_output_file" metadata_source="input_output_file" label="${tool.name} on ${on_string}: Output File"/>
        <data name="GALAXY_ANVIO_LOG" format="txt" label="${tool.name} on ${on_string}: Log"/>
    </outputs>
    <help><![CDATA[
        usage: anvi-get-short-reads-mapping-to-a-gene [-h] -i INPUT_BAMS) [INPUT_BAM(S ...] -c
                              CONTIGS_DB --gene-caller-id GENE_CALLER_ID -o
                              FILE_PATH [--leeway LEEWAY_NTs]

Access reads in contigs and positions in a BAM file

optional arguments:
  -h, --help            show this help message and exit
  -i INPUT_BAM(S) [INPUT_BAM(S) ...], --input-files INPUT_BAM(S) [INPUT_BAM(S) ...]
                        Sorted and indexed BAM files to analyze. It is
                        essential that all BAM files must be the result of
                        mappings against the same contigs.
  -c CONTIGS_DB, --contigs-db CONTIGS_DB
                        Anvi'o contigs database generated by 'anvi-gen-
                        contigs'
  --gene-caller-id GENE_CALLER_ID
                        A single gene id.
  -o FILE_PATH, --output-file FILE_PATH
                        File path to store results.
  --leeway LEEWAY_NTs   The minimum number of nucleotides for a given short
                        read mapping into the gene context for it to be
                        reported. You must consider the length of your short
                        reads, as well as the length of the gene you are
                        targeting. The default is 100 nts.

    ]]></help>
    <citations>
        <citation type="doi">10.7717/peerj.1319</citation>
        <citation type="bibtex">@ARTICLE{Blankenberg19-anvio,
   author = {Daniel Blankenberg, et al},
   title = {In preparation..},
   }</citation>
    </citations>
</tool>