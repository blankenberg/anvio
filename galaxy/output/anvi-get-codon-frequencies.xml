<tool id="anvi_get_codon_frequencies" name="anvi-get-codon-frequencies" version="5.3.0" tool_type="default">
    <description>Get amino acid or codon frequencies of genes in a contigs database, or or get the same information                                                  considering the make up of the environmnet captured in a BAM file through the mapped reads.                                                  What is the difference? The first one will give you AA or CDN frequencies given a set of genes. In                                                  contrast, the latter will also take a BAM file, and will give you AA or CDN frequencies of the                                                  environment. If you want to know the frequencies of residues of a "gene" you do not need a BAM                                                  file. If you want the frequencies you observe in actual read recruitment results, then you need                                                  provide a BAM file. The latter will give you frequencies of CDN or AA "linkmers" an anvio trick                                                  that, for each codon position, enables you to work with only the short reads that fully cover the                                                  codon to ensure molecular linkage between bases (well, assuming there are no sequencing errors).</description>
    <requirements>
        <requirement type="package" version="5.3.0">anvio</requirement>
    </requirements>
    <stdio>
        <exit_code range="1:" />
    </stdio>
    <version_command>anvi-get-codon-frequencies --version</version_command>
    <command><![CDATA[
        cp -R '${input_contigs_db.extra_files_path}' '${output_contigs_db.extra_files_path}'
 && 

    #if $bam_file:
        ln -s '${bam_file}' 'bam_file.bam' && ln -s '${bam_file.metadata.bam_index}' 'bam_file.bam.bai'
    #else
        echo ''
    #end if
 &&
 anvi-get-codon-frequencies
--contigs-db '${output_contigs_db.extra_files_path}/CONTIGS.db'


#if $bam_file:
    --bam-file 'bam_file.bam'
#end if


#if $str( $gene_caller_id ):
    --gene-caller-id '${gene_caller_id}'
#end if

${return_AA_frequencies_instead}

--output-file '${output_file}'

${percent_normalize}

${merens_codon_normalization}

&> '${GALAXY_ANVIO_LOG}'

    ]]></command>
    <inputs>
        <param name="input_contigs_db" type="data" label="Contigs Db" format="anvio_contigs_db" optional="False" multiple="False" argument="--contigs-db" help="Anvi'o contigs database generated by 'anvi-gen-contigs'"/>
        <param name="bam_file" type="data" label="Bam File" format="bam" optional="True" multiple="False" argument="--bam-file" help="Sorted and indexed BAM file to analyze."/>
        <param name="gene_caller_id" type="integer" label="Gene Caller Id" value="" optional="True" argument="--gene-caller-id" help="OK. You can declare a single gene caller ID if you wish, in which case anvi'o would only return results for a single gene call. If you don't declare anything, well, you must be prepared to brace yourself if you are working with a very large contigs database with hundreds of thousands of genes."/>
        <param name="return_AA_frequencies_instead" type="boolean" label="Return Aa Frequencies Instead" truevalue="--return-AA-frequencies-instead" falsevalue="" checked="False" optional="True" argument="--return-AA-frequencies-instead" help="By default, anvi'o will return codon frequencies (as the name suggests), but you can ask for amino acid frequencies instead, simply because you always need more data and more stuff. You're lucky this time, but is there an end to this? Will you ever be satisfied with what you have? Anvi'o needs answers."/>
        <param name="percent_normalize" type="boolean" label="Percent Normalize" truevalue="--percent-normalize" falsevalue="" checked="False" optional="True" argument="--percent-normalize" help="Instead of actual counts, report percent-normalized frequencies per gene (because you are too lazy to do things the proper way in R)."/>
        <param name="merens_codon_normalization" type="boolean" label="Merens Codon Normalization" truevalue="--merens-codon-normalization" falsevalue="" checked="False" optional="True" argument="--merens-codon-normalization" help="This is a flag to percent normalize codon frequenies within those that encode for the same amino acid. It is different from the flag --percent-normalize, since it does not percent normalize frequencies of codons within a gene based on all codon frequencies. Clearly this flag is not applicable if you wish to work with boring amino acids. WHO WORKS WITH AMINO ACIDS ANYWAY."/>
    </inputs>
    <outputs>
        <data name="output_contigs_db" format="anvio_contigs_db" format_source="input_contigs_db" metadata_source="input_contigs_db" label="${tool.name} on ${on_string}: Contigs Db"/>
        <data name="output_file" format="txt" format_source="input_output_file" metadata_source="input_output_file" label="${tool.name} on ${on_string}: Output File"/>
        <data name="GALAXY_ANVIO_LOG" format="txt" label="${tool.name} on ${on_string}: Log"/>
    </outputs>
    <help><![CDATA[
        usage: anvi-get-codon-frequencies [-h] -c CONTIGS_DB [-b INPUT_BAM]
                              [--gene-caller-id GENE_CALLER_ID]
                              [--return-AA-frequencies-instead] -o FILE_PATH
                              [--percent-normalize]
                              [--merens-codon-normalization]

Get amino acid or codon frequencies of genes in a contigs database, or or get
the same information considering the make up of the environmnet captured in a
BAM file through the mapped reads. What is the difference? The first one will
give you AA or CDN frequencies given a set of genes. In contrast, the latter
will also take a BAM file, and will give you AA or CDN frequencies of the
environment. If you want to know the frequencies of residues of a "gene" you
do not need a BAM file. If you want the frequencies you observe in actual read
recruitment results, then you need provide a BAM file. The latter will give
you frequencies of CDN or AA "linkmers" an anvio trick that, for each codon
position, enables you to work with only the short reads that fully cover the
codon to ensure molecular linkage between bases (well, assuming there are no
sequencing errors).

optional arguments:
  -h, --help            show this help message and exit
  -c CONTIGS_DB, --contigs-db CONTIGS_DB
                        Anvi'o contigs database generated by 'anvi-gen-
                        contigs'
  -b INPUT_BAM, --bam-file INPUT_BAM
                        Sorted and indexed BAM file to analyze.
  --gene-caller-id GENE_CALLER_ID
                        OK. You can declare a single gene caller ID if you
                        wish, in which case anvi'o would only return results
                        for a single gene call. If you don't declare anything,
                        well, you must be prepared to brace yourself if you
                        are working with a very large contigs database with
                        hundreds of thousands of genes.
  --return-AA-frequencies-instead
                        By default, anvi'o will return codon frequencies (as
                        the name suggests), but you can ask for amino acid
                        frequencies instead, simply because you always need
                        more data and more stuff. You're lucky this time, but
                        is there an end to this? Will you ever be satisfied
                        with what you have? Anvi'o needs answers.
  -o FILE_PATH, --output-file FILE_PATH
                        File path to store results.
  --percent-normalize   Instead of actual counts, report percent-normalized
                        frequencies per gene (because you are too lazy to do
                        things the proper way in R).
  --merens-codon-normalization
                        This is a flag to percent normalize codon frequenies
                        within those that encode for the same amino acid. It
                        is different from the flag --percent-normalize, since
                        it does not percent normalize frequencies of codons
                        within a gene based on all codon frequencies. Clearly
                        this flag is not applicable if you wish to work with
                        boring amino acids. WHO WORKS WITH AMINO ACIDS ANYWAY.

INPUT DATABASE:
  The contigs database. Clearly those genes must be read from somewhere.

BAM FILE?:
  Optional BAM file to recover CDN/AA frequencies among the mapped reads. It
  is OK to not provide one. Read the help menu of the program for more
  information.

COMMON OPTIONALS:
  Important things to read never end. Stupid science.

NON-BAM OPTIONALS:
  Optional flags that will only be taken into consideration if you are not
  working with BAM file.

    ]]></help>
    <citations>
        <citation type="doi">10.7717/peerj.1319</citation>
        <citation type="bibtex">@ARTICLE{Blankenberg19-anvio,
   author = {Daniel Blankenberg, et al},
   title = {In preparation..},
   }</citation>
    </citations>
</tool>