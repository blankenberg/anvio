<tool id="anvi_get_sequences_for_hmm_hits" name="anvi-get-sequences-for-hmm-hits" version="5.3">
    <description>Get sequences for HMM hits from many inputs.</description>
    <requirements>
        <requirement type="package" version="5.3">anvio</requirement>
    </requirements>
    <stdio>
        <exit_code range="1:" />
    </stdio>
    <version_command>anvi-get-sequences-for-hmm-hits --version</version_command>
    <command><![CDATA[
        
    #if $input_contigs_db:
        cp -R '${input_contigs_db.extra_files_path}' '${output_contigs_db.extra_files_path}'
    #else
        echo ''
    #end if
 && 

    #if $input_profile_db:
        cp -R '${input_profile_db.extra_files_path}' '${output_profile_db.extra_files_path}'
    #else
        echo ''
    #end if
 &&
 anvi-get-sequences-for-hmm-hits
--contigs-db '${output_contigs_db.extra_files_path}/CONTIGS.db'

--profile-db '${output_profile_db.extra_files_path}/PROFILE.db'


#if $str( $collection_name ):
    --collection-name '${collection_name}'
#end if


#if $str( $bin_id ):
    --bin-id '${bin_id}'
#end if


#if $bin_ids_file:
    --bin-ids-file '${bin_ids_file}'
#end if


#if $external_genomes:
    --external-genomes '${external_genomes}'
#end if


#if $internal_genomes:
    --internal-genomes '${internal_genomes}'
#end if


#if $str( $hmm_sources ):
    --hmm-sources '${hmm_sources}'
#end if


#if $str( $gene_names ):
    --gene-names '${gene_names}'
#end if

${list_hmm_sources}

${list_available_gene_names}


#if $output_file:
    --output-file '${output_file}'
#end if

${no_wrap}

${get_aa_sequences}

${concatenate_genes}


#if $str( $max_num_genes_missing_from_bin ):
    --max-num-genes-missing-from-bin '${max_num_genes_missing_from_bin}'
#end if


#if $str( $min_num_bins_gene_occurs ):
    --min-num-bins-gene-occurs '${min_num_bins_gene_occurs}'
#end if


#if $str( $align_with ):
    --align-with '${align_with}'
#end if


#if $str( $separator ):
    --separator '${separator}'
#end if

${return_best_hit}

&> '${GALAXY_ANVIO_LOG}'

    ]]></command>
    <inputs>
        <param name="input_contigs_db" type="data" label="Contigs Db" format="anvio_contigs_db" optional="True" multiple="False" argument="--contigs-db" help="Anvi'o contigs database generated by 'anvi-gen-contigs'"/>
        <param name="input_profile_db" type="data" label="Profile Db" format="anvio_profile_db" optional="True" multiple="False" argument="--profile-db" help="Anvi'o profile database"/>
        <param name="collection_name" type="text" label="Collection Name" value="" optional="True" argument="--collection-name" help="Collection name."/>
        <param name="bin_id" type="text" label="Bin Id" value="" optional="True" argument="--bin-id" help="Bin name you are interested in."/>
        <param name="bin_ids_file" type="data" label="Bin Ids File" format="txt" optional="True" multiple="False" argument="--bin-ids-file" help="Text file for bins (each line should be a unique bin id)."/>
        <param name="external_genomes" type="data" label="External Genomes" format="txt" optional="True" multiple="False" argument="--external-genomes" help="A two-column TAB-delimited flat text file that lists anvi'o contigs databases. The first item in the header line should read 'name', and the second should read 'contigs_db_path'. Each line in the file should describe a single entry, where the first column is the name of the genome (or MAG), and the second column is the anvi'o contigs database generated for this genome."/>
        <param name="internal_genomes" type="data" label="Internal Genomes" format="txt" optional="True" multiple="False" argument="--internal-genomes" help="A five-column TAB-delimited flat text file. The header line must contain thse columns: 'name', 'bin_id', 'collection_id', 'profile_db_path', 'contigs_db_path'. Each line should list a single entry, where 'name' can be any name to describe the anvi'o bin identified as 'bin_id' that is stored in a collection."/>
        <param name="hmm_sources" type="text" label="Hmm Sources" value="" optional="True" argument="--hmm-sources" help="Get sequences for a specific list of HMM sources. You can list one or more sources by separating them from each other with a comma character (i.e., '--hmm-sources source_1,source_2,source_3'). If you would like to see a list of available sources in the contigs database, run this program with '--list-hmm-sources' flag."/>
        <param name="gene_names" type="text" label="Gene Names" value="" optional="True" argument="--gene-names" help="Get sequences only for a specific gene name. Each name should be separated from each other by a comma character. For instance, if you want to get back only RecA and Ribosomal_L27, you can type '--gene-names RecA,Ribosomal_L27', and you will get any and every hit that matches these names in any source. If you would like to see a list of available gene names, you can use '--list-available-gene-names' flag."/>
        <param name="list_hmm_sources" type="boolean" label="List Hmm Sources" truevalue="--list-hmm-sources" falsevalue="" checked="False" optional="True" argument="--list-hmm-sources" help="List available HMM sources in the contigs database and quit."/>
        <param name="list_available_gene_names" type="boolean" label="List Available Gene Names" truevalue="--list-available-gene-names" falsevalue="" checked="False" optional="True" argument="--list-available-gene-names" help="List available gene names in HMM sources selection and quit."/>
        <param name="no_wrap" type="boolean" label="No Wrap" truevalue="--no-wrap" falsevalue="" checked="False" optional="True" argument="--no-wrap" help="Do not be wrap sequences nicely in the output file."/>
        <param name="get_aa_sequences" type="boolean" label="Get Aa Sequences" truevalue="--get-aa-sequences" falsevalue="" checked="False" optional="True" argument="--get-aa-sequences" help="Store amino acid sequences instead."/>
        <param name="concatenate_genes" type="boolean" label="Concatenate Genes" truevalue="--concatenate-genes" falsevalue="" checked="False" optional="True" argument="--concatenate-genes" help="Concatenate output genes in the same order to create a multi-gene alignment output that is suitable for phylogenomic analyses."/>
        <param name="max_num_genes_missing_from_bin" type="integer" label="Max Num Genes Missing From Bin" value="" optional="True" argument="--max-num-genes-missing-from-bin" help="This filter removes bins (or genomes) from your analysis. If you have a list of gene names, you can use this parameter to omit any bin (or external genome) that is missing more than a number of genes you desire. For instance, if you have 100 genome bins, and you are interested in working with 5 ribosomal proteins, you can use '--max-num-genes-missing-from-bin 4' to remove remove the bins that are missing more than 4 of those 5 genes. This is especially useful for phylogenomic analyses. Parameter 0 will remove any bin that is missing any of the genes."/>
        <param name="min_num_bins_gene_occurs" type="integer" label="Min Num Bins Gene Occurs" value="" optional="True" argument="--min-num-bins-gene-occurs" help="This filter removes genes from your analysis. Let's assume you have 100 bins to get sequences for HMM hits. If you want to work only with genes among all the hits that occur in at least X number of bins, and discard the rest of them, you can use this flag. If you say '--min-num-bins-gene-occurs 90', each gene in the analysis will be required at least to appear in 90 genomes. If a gene occurs in less than that number of genomes, it simply will not be reported. This is especially useful for phylogenomic analyses, where you may want to only focus on genes that are prevalent across the set of genomes you wish to analyze."/>
        <param name="align_with" type="text" label="Align With" value="" optional="True" argument="--align-with" help="The multiple sequnce alignment program to use when multiple seqeunce alignment is necessary. To see all available optons, use the flag `--list-aligners`."/>
        <param name="separator" type="text" label="Separator" value="" optional="True" argument="--separator" help='A word that will be used to sepaate concatenated gene sequences from each other (IF you are using this program with `--concatenate-genes` flag). The default is "XXX" for amino acid sequences, and "NNN" for DNA sequences'/>
        <param name="return_best_hit" type="boolean" label="Return Best Hit" truevalue="--return-best-hit" falsevalue="" checked="False" optional="True" argument="--return-best-hit" help="A bin may contain more than one hit for a gene name in a given HMM source. For instance, there may be multiple RecA hits in a genome bin from Campbell et al.. Using this flag, will go through all of the gene names that appear multiple times, and remove all but the one with the lowest e-value. Good for whenever you really need to get only a single copy of single-copy core genes from a genome bin."/>
    </inputs>
    <outputs>
        <data name="output_contigs_db" format="anvio_contigs_db" format_source="input_contigs_db" metadata_source="input_contigs_db" label="${tool.name} on ${on_string}: Contigs Db"/>
        <data name="output_profile_db" format="anvio_profile_db" format_source="input_profile_db" metadata_source="input_profile_db" label="${tool.name} on ${on_string}: Profile Db"/>
        <data name="output_file" format="txt" format_source="input_output_file" metadata_source="input_output_file" label="${tool.name} on ${on_string}: Output File"/>
        <data name="GALAXY_ANVIO_LOG" format="txt" label="${tool.name} on ${on_string}: Log"/>
    </outputs>
    <help><![CDATA[
        usage: anvi-get-sequences-for-hmm-hits [-h] [-c CONTIGS_DB] [-p PROFILE_DB]
                              [-C COLLECTION_NAME] [-b BIN_NAME]
                              [-B FILE_PATH] [-e FILE_PATH] [-i FILE_PATH]
                              [--hmm-sources SOURCE NAME]
                              [--gene-names HMM HIT NAME] [-l] [-L]
                              [-o FILE_PATH] [--no-wrap] [--get-aa-sequences]
                              [--concatenate-genes]
                              [--max-num-genes-missing-from-bin INTEGER]
                              [--min-num-bins-gene-occurs INTEGER]
                              [--align-with ALIGNER] [--separator STRING]
                              [--return-best-hit]

Get sequences for HMM hits from many inputs.

optional arguments:
  -h, --help            show this help message and exit
  -c CONTIGS_DB, --contigs-db CONTIGS_DB
                        Anvi'o contigs database generated by 'anvi-gen-
                        contigs'
  -p PROFILE_DB, --profile-db PROFILE_DB
                        Anvi'o profile database
  -C COLLECTION_NAME, --collection-name COLLECTION_NAME
                        Collection name.
  -b BIN_NAME, --bin-id BIN_NAME
                        Bin name you are interested in.
  -B FILE_PATH, --bin-ids-file FILE_PATH
                        Text file for bins (each line should be a unique bin
                        id).
  -e FILE_PATH, --external-genomes FILE_PATH
                        A two-column TAB-delimited flat text file that lists
                        anvi'o contigs databases. The first item in the header
                        line should read 'name', and the second should read
                        'contigs_db_path'. Each line in the file should
                        describe a single entry, where the first column is the
                        name of the genome (or MAG), and the second column is
                        the anvi'o contigs database generated for this genome.
  -i FILE_PATH, --internal-genomes FILE_PATH
                        A five-column TAB-delimited flat text file. The header
                        line must contain thse columns: 'name', 'bin_id',
                        'collection_id', 'profile_db_path', 'contigs_db_path'.
                        Each line should list a single entry, where 'name' can
                        be any name to describe the anvi'o bin identified as
                        'bin_id' that is stored in a collection.
  --hmm-sources SOURCE NAME
                        Get sequences for a specific list of HMM sources. You
                        can list one or more sources by separating them from
                        each other with a comma character (i.e., '--hmm-
                        sources source_1,source_2,source_3'). If you would
                        like to see a list of available sources in the contigs
                        database, run this program with '--list-hmm-sources'
                        flag.
  --gene-names HMM HIT NAME
                        Get sequences only for a specific gene name. Each name
                        should be separated from each other by a comma
                        character. For instance, if you want to get back only
                        RecA and Ribosomal_L27, you can type '--gene-names
                        RecA,Ribosomal_L27', and you will get any and every
                        hit that matches these names in any source. If you
                        would like to see a list of available gene names, you
                        can use '--list-available-gene-names' flag.
  -l, --list-hmm-sources
                        List available HMM sources in the contigs database and
                        quit.
  -L, --list-available-gene-names
                        List available gene names in HMM sources selection and
                        quit.
  -o FILE_PATH, --output-file FILE_PATH
                        File path to store results.
  --no-wrap             Do not be wrap sequences nicely in the output file.
  --get-aa-sequences    Store amino acid sequences instead.
  --concatenate-genes   Concatenate output genes in the same order to create a
                        multi-gene alignment output that is suitable for
                        phylogenomic analyses.
  --max-num-genes-missing-from-bin INTEGER
                        This filter removes bins (or genomes) from your
                        analysis. If you have a list of gene names, you can
                        use this parameter to omit any bin (or external
                        genome) that is missing more than a number of genes
                        you desire. For instance, if you have 100 genome bins,
                        and you are interested in working with 5 ribosomal
                        proteins, you can use '--max-num-genes-missing-from-
                        bin 4' to remove remove the bins that are missing more
                        than 4 of those 5 genes. This is especially useful for
                        phylogenomic analyses. Parameter 0 will remove any bin
                        that is missing any of the genes.
  --min-num-bins-gene-occurs INTEGER
                        This filter removes genes from your analysis. Let's
                        assume you have 100 bins to get sequences for HMM
                        hits. If you want to work only with genes among all
                        the hits that occur in at least X number of bins, and
                        discard the rest of them, you can use this flag. If
                        you say '--min-num-bins-gene-occurs 90', each gene in
                        the analysis will be required at least to appear in 90
                        genomes. If a gene occurs in less than that number of
                        genomes, it simply will not be reported. This is
                        especially useful for phylogenomic analyses, where you
                        may want to only focus on genes that are prevalent
                        across the set of genomes you wish to analyze.
  --align-with ALIGNER  The multiple sequnce alignment program to use when
                        multiple seqeunce alignment is necessary. To see all
                        available optons, use the flag `--list-aligners`.
  --separator STRING    A word that will be used to sepaate concatenated gene
                        sequences from each other (IF you are using this
                        program with `--concatenate-genes` flag). The default
                        is "XXX" for amino acid sequences, and "NNN" for DNA
                        sequences
  --return-best-hit     A bin may contain more than one hit for a gene name in
                        a given HMM source. For instance, there may be
                        multiple RecA hits in a genome bin from Campbell et
                        al.. Using this flag, will go through all of the gene
                        names that appear multiple times, and remove all but
                        the one with the lowest e-value. Good for whenever you
                        really need to get only a single copy of single-copy
                        core genes from a genome bin.

INPUT OPTION #1: CONTIGS DB:
  There are multiple ways to access to sequences. Your first option is to
  provide a contigs database, and call it a day. In this case the program
  will return you everything from it.

INPUT OPTION #2: CONTIGS DB + PROFLIE DB:
  You can also work with anvi'o profile databases and collections stored in
  them. If you go this way, you still will need to provide a contigs
  database. If you just specify a collection name, you will get hits from
  every bin in it. You can also use the bin name or bin ids file parameters
  to specify your interest more precisely.

INPUT OPTION #3: INT/EXTERNAL GENOMES FILE:
  Yes. You can alternatively use as input an internal or external genomes
  file, or both of them together. If you have multiple contigs databases
  without any profile database, you can use the external genomes file. So if
  you just have a bunch of FASTA files and nothing else, this is what you
  need. In contrast, if you want to access to genes in bins described in
  collections stored in anvi'o profile databases, then you can use internal
  genomes file route. Or you can mix the two, because why not. There is not
  much room for excuses here.

HMM STUFF:
  This is where you can specify an HMM source, and/or a list of genes to
  filter your results.

THE OUTPUT:
  Where should the output go. It will be a FASTA file, and you better give
  it a nice name..

THE ALPHABET:
  The sequences are reported in DNA alphabet, but you can also get them
  translated just like all the other cool kids.

PHYLOGENOMICS? K!:
  If you want, you can get your sequences concatanated. In this case anwi'o
  will use muscle to align every homolog, and concatenate them the order you
  specified using the `gene-names` argument. Each concatenated sequence will
  be separated from the other ones by the `separator`.

OPTIONAL:
  Everything is optional, but some options are more optional than others.

    ]]></help>
    <citations>
        <citation type="doi">10.7717/peerj.1319</citation>
        <citation type="bibtex">@ARTICLE{Blankenberg19-anvio,
   author = {Daniel Blankenberg, et al},
   title = {In preparation..},
   }</citation>
    </citations>
</tool>