<tool id="anvi_export_splits_and_coverages" name="anvi-export-splits-and-coverages" version="5.2">
    <description>Export sequences and mean coverages across samples for splits or contigs</description>
    <requirements>
        <requirement type="package" version="5.2">anvio</requirement>
    </requirements>
    <stdio>
        <exit_code range="1:" />
    </stdio>
    <version_command>anvi-export-splits-and-coverages --version</version_command>
    <command><![CDATA[
        cp -R '${input_profile_db.extra_files_path}' '${output_profile_db.extra_files_path}'
 && 
cp -R '${input_contigs_db.extra_files_path}' '${output_contigs_db.extra_files_path}'
 && 
mkdir ${output_file_prefix.extra_files_path}
 &&
 anvi-export-splits-and-coverages
--profile-db '${output_profile_db.extra_files_path}/PROFILE.db'

--contigs-db '${output_contigs_db.extra_files_path}/CONTIGS.db'


#if $output_dir:
    --output-dir '${output_dir.extra_files_path}'
#end if


#if $str( $output_file_prefix ):
    --output-file-prefix 'output_file_prefix'
#end if

${splits_mode}

${report_contigs}

${use_Q2Q3_coverages}

&> '${GALAXY_ANVIO_LOG}'

 &&
 ( cp output_file_prefix* '${output_file_prefix.extra_files_path}/' || echo '' )
 &&
ls -lahR
    ]]></command>
    <inputs>
        <param name="input_profile_db" type="data" label="Profile Db" format="anvio_profile_db" optional="False" multiple="False" argument="--profile-db" help="Anvi'o profile database"/>
        <param name="input_contigs_db" type="data" label="Contigs Db" format="anvio_contigs_db" optional="False" multiple="False" argument="--contigs-db" help="Anvi'o contigs database generated by 'anvi-gen-contigs'"/>
        <param name="splits_mode" type="boolean" label="Splits Mode" truevalue="--splits-mode" falsevalue="" checked="False" optional="True" argument="--splits-mode" help="Specify this flag if you would like to output coverages of individual 'splits', rather than their 'parent' contig coverages."/>
        <param name="report_contigs" type="boolean" label="Report Contigs" truevalue="--report-contigs" falsevalue="" checked="False" optional="True" argument="--report-contigs" help="By default this program reports sequences and their coverages for 'splits'. By using this flag, you can report contig sequences and coverages instead. For obvious reasons, you can't use this flag with `--splits-mode` flag."/>
        <param name="use_Q2Q3_coverages" type="boolean" label="Use Q2Q3 Coverages" truevalue="--use-Q2Q3-coverages" falsevalue="" checked="False" optional="True" argument="--use-Q2Q3-coverages" help="By default this program reports the mean coverage of a split (or contig, see --report-contigs) for each sample. By using this flag, you can report the mean Q2Q3 coverage by excluding 25 percent of the nucleotide positions with the smallest coverage values, and 25 percent of the nucleotide positions with the largest coverage values. The hope is that this removes 'outlier' positions resulting from non-specific mapping, etc. that skew the mean coverage estimate."/>
    </inputs>
    <outputs>
        <data name="output_profile_db" format="anvio_profile_db" format_source="input_profile_db" metadata_source="input_profile_db" label="${tool.name} on ${on_string}: Profile Db"/>
        <data name="output_contigs_db" format="anvio_contigs_db" format_source="input_contigs_db" metadata_source="input_contigs_db" label="${tool.name} on ${on_string}: Contigs Db"/>
        <data name="output_dir" format="anvio_profile_db" format_source="input_output_dir" metadata_source="input_output_dir" label="${tool.name} on ${on_string}: Output Dir"/>
        <data name="output_file_prefix" format="anvio_composite" format_source="input_output_file_prefix" metadata_source="input_output_file_prefix" label="${tool.name} on ${on_string}: Output File Prefix"/>
        <data name="GALAXY_ANVIO_LOG" format="txt" label="${tool.name} on ${on_string}: Log"/>
    </outputs>
    <help><![CDATA[
        usage: anvi-export-splits-and-coverages [-h] -p PROFILE_DB -c CONTIGS_DB [-o DIR_PATH]
                              [-O FILENAME_PREFIX] [--splits-mode]
                              [--report-contigs] [--use-Q2Q3-coverages]

Export sequences and mean coverages across samples for splits or contigs

optional arguments:
  -h, --help            show this help message and exit
  -p PROFILE_DB, --profile-db PROFILE_DB
                        Anvi'o profile database
  -c CONTIGS_DB, --contigs-db CONTIGS_DB
                        Anvi'o contigs database generated by 'anvi-gen-
                        contigs'
  -o DIR_PATH, --output-dir DIR_PATH
                        Directory path for output files
  -O FILENAME_PREFIX, --output-file-prefix FILENAME_PREFIX
                        A prefix to be used while naming the output files (no
                        file type extensions please; just a prefix).
  --splits-mode         Specify this flag if you would like to output
                        coverages of individual 'splits', rather than their
                        'parent' contig coverages.
  --report-contigs      By default this program reports sequences and their
                        coverages for 'splits'. By using this flag, you can
                        report contig sequences and coverages instead. For
                        obvious reasons, you can't use this flag with
                        `--splits-mode` flag.
  --use-Q2Q3-coverages  By default this program reports the mean coverage of a
                        split (or contig, see --report-contigs) for each
                        sample. By using this flag, you can report the mean
                        Q2Q3 coverage by excluding 25 percent of the
                        nucleotide positions with the smallest coverage
                        values, and 25 percent of the nucleotide positions
                        with the largest coverage values. The hope is that
                        this removes 'outlier' positions resulting from non-
                        specific mapping, etc. that skew the mean coverage
                        estimate.

    ]]></help>
    <citations>
        <citation type="doi">10.7717/peerj.1319</citation>
    </citations>
</tool>