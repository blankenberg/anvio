<tool id="anvi_script_run_eggnog_mapper" name="anvi-script-run-eggnog-mapper" version="5.3.0">
    <description>Run eggnog-mapper on a contigs database, and store results</description>
    <requirements>
        <requirement type="package" version="5.3.0">anvio</requirement>
    </requirements>
    <stdio>
        <exit_code range="1:" />
    </stdio>
    <version_command>anvi-script-run-eggnog-mapper --version</version_command>
    <command><![CDATA[
        cp -R '${input_contigs_db.extra_files_path}' '${output_contigs_db.extra_files_path}'
 && 

    #if $input_cog_data_dir:
        cp -R '${input_cog_data_dir.extra_files_path}' '${output_cog_data_dir.extra_files_path}'
    #else
        echo ''
    #end if
 &&
 anvi-script-run-eggnog-mapper
--contigs-db '${output_contigs_db.extra_files_path}/CONTIGS.db'

--cog-data-dir '${output_cog_data_dir.extra_files_path}'

--num-threads "\${GALAXY_SLOTS:-1}"

${drop_previous_annotations}


#if $annotation:
    --annotation '${annotation}'
#end if


#if $str( $use_version ):
    --use-version '${use_version}'
#end if

&> '${GALAXY_ANVIO_LOG}'

    ]]></command>
    <inputs>
        <param name="input_contigs_db" type="data" label="Contigs Db" format="anvio_contigs_db" optional="False" multiple="False" argument="--contigs-db" help="Anvi'o contigs database generated by 'anvi-gen-contigs'"/>
        <param name="input_cog_data_dir" type="data" label="Cog Data Dir" format="anvio_cog_profile" optional="True" multiple="False" argument="--cog-data-dir" help="The directory path for your COG setup if you did not use the default directory."/>
        <param name="drop_previous_annotations" type="boolean" label="Drop Previous Annotations" truevalue="--drop-previous-annotations" falsevalue="" checked="False" optional="True" argument="--drop-previous-annotations" help="When declared, previous annotations in the database will be dropped."/>
        <param name="annotation" type="data" label="Annotation" format="txt" optional="True" multiple="False" argument="--annotation" help="If you have an annotation file from a previous run, you can call this program to import the contents of that file into the database instead of a run from scratch. In that case, you must also use the `--use-version` parameter to clarify which parser version should be used to parse it."/>
        <param name="use_version" type="text" label="Use Version" value="0.12.6" optional="True" argument="--use-version" help="The version of eggnog-mapper that generated the annotation file."/>
    </inputs>
    <outputs>
        <data name="output_contigs_db" format="anvio_contigs_db" format_source="input_contigs_db" metadata_source="input_contigs_db" label="${tool.name} on ${on_string}: Contigs Db"/>
        <data name="output_cog_data_dir" format="anvio_cog_profile" format_source="input_cog_data_dir" metadata_source="input_cog_data_dir" label="${tool.name} on ${on_string}: Cog Data Dir"/>
        <data name="GALAXY_ANVIO_LOG" format="txt" label="${tool.name} on ${on_string}: Log"/>
    </outputs>
    <help><![CDATA[
        usage: anvi-script-run-eggnog-mapper [-h] -c CONTIGS_DB [--cog-data-dir COG_DATA_DIR]
                              [-T NUM_THREADS] [--drop-previous-annotations]
                              [--annotation EMAPPER_ANNOTATION_FILE]
                              [--use-version EMAPPER_VERSION]

Run eggnog-mapper on a contigs database, and store results

optional arguments:
  -h, --help            show this help message and exit
  -c CONTIGS_DB, --contigs-db CONTIGS_DB
                        Anvi'o contigs database generated by 'anvi-gen-
                        contigs'
  --cog-data-dir COG_DATA_DIR
                        The directory path for your COG setup if you did not
                        use the default directory.
  -T NUM_THREADS, --num-threads NUM_THREADS
                        Maximum number of threads to use for multithreading
                        whenever possible. Very conservatively, the default is
                        1. It is a good idea to not exceed the number of CPUs
                        / cores on your system. Plus, please be careful with
                        this option if you are running your commands on a SGE
                        --if you are clusterizing your runs, and asking for
                        multiple threads to use, you may deplete your
                        resources very fast.
  --drop-previous-annotations
                        When declared, previous annotations in the database
                        will be dropped.
  --annotation EMAPPER_ANNOTATION_FILE
                        If you have an annotation file from a previous run,
                        you can call this program to import the contents of
                        that file into the database instead of a run from
                        scratch. In that case, you must also use the `--use-
                        version` parameter to clarify which parser version
                        should be used to parse it.
  --use-version EMAPPER_VERSION
                        The version of eggnog-mapper that generated the
                        annotation file.

    ]]></help>
    <citations>
        <citation type="doi">10.7717/peerj.1319</citation>
        <citation type="bibtex">@ARTICLE{Blankenberg19-anvio,
   author = {Daniel Blankenberg, et al},
   title = {In preparation..},
   }</citation>
    </citations>
</tool>