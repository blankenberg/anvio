<tool id="anvi_rename_bins" name="anvi-rename-bins" version="5.2">
    <description>Rename all bins in a given collection (so they have pretty names).</description>
    <requirements>
        <requirement type="package" version="5.2">anvio</requirement>
    </requirements>
    <stdio>
        <exit_code range="1:" />
    </stdio>
    <version_command>anvi-rename-bins --version</version_command>
    <command><![CDATA[
        cp -R '${input_contigs_db.extra_files_path}' '${output_contigs_db.extra_files_path}'
 && 
cp -R '${input_profile_db.extra_files_path}' '${output_profile_db.extra_files_path}'
 &&
 anvi-rename-bins
--contigs-db '${output_contigs_db.extra_files_path}/CONTIGS.db'

--profile-db '${output_profile_db.extra_files_path}/PROFILE.db'


#if $str( $collection_to_read ):
    --collection-to-read '${collection_to_read}'
#end if


#if $str( $collection_to_write ):
    --collection-to-write '${collection_to_write}'
#end if


#if $str( $prefix ):
    --prefix '${prefix}'
#end if


#if $report_file:
    --report-file '${report_file}'
#end if

${list_collections}

${dry_run}

${call_MAGs}


#if $str( $min_completion_for_MAG ):
    --min-completion-for-MAG '${min_completion_for_MAG}'
#end if


#if $str( $max_redundancy_for_MAG ):
    --max-redundancy-for-MAG '${max_redundancy_for_MAG}'
#end if


#if $str( $size_for_MAG ):
    --size-for-MAG '${size_for_MAG}'
#end if

&> '${GALAXY_ANVIO_LOG}'

    ]]></command>
    <inputs>
        <param name="input_contigs_db" type="data" label="Contigs Db" format="anvio_contigs_db" optional="False" multiple="False" argument="--contigs-db" help="Anvi'o contigs database generated by 'anvi-gen-contigs'"/>
        <param name="input_profile_db" type="data" label="Profile Db" format="anvio_profile_db" optional="False" multiple="False" argument="--profile-db" help="Anvi'o profile database"/>
        <param name="collection_to_read" type="text" label="Collection To Read" value="" optional="True" argument="--collection-to-read" help="Collection name to read from. Anvi'o will not overwrite an existing collection, instead, it will create a copy of your collection with new bin names."/>
        <param name="collection_to_write" type="text" label="Collection To Write" value="" optional="True" argument="--collection-to-write" help="The new collection name. Give it a nice, fancy name."/>
        <param name="prefix" type="text" label="Prefix" value="" optional="True" argument="--prefix" help="Prefix for the bin names. Must be a single word, composed of digits and numbers. The use of the underscore character is OK, but that's about it (fine, the use of the dash character is OK, too but no more!). If the prefix is 'PREFIX', each bin will be renamed as 'PREFIX_XXX_00001, PREFIX_XXX_00002', and so on, in the order of percent completion minus percent redundancy (what we call, 'substantive completion'). The 'XXX' part will either be 'Bin', or 'MAG depending on other parameters you use. Keep reading."/>
        <param name="list_collections" type="boolean" label="List Collections" truevalue="--list-collections" falsevalue="" checked="False" optional="True" argument="--list-collections" help="Show available collections and exit."/>
        <param name="dry_run" type="boolean" label="Dry Run" truevalue="--dry-run" falsevalue="" checked="False" optional="True" argument="--dry-run" help="When used does NOT update the profile database, just creates the report file so you can view how things will be renamed."/>
        <param name="call_MAGs" type="boolean" label="Call Mags" truevalue="--call-MAGs" falsevalue="" checked="False" optional="True" argument="--call-MAGs" help="This program by default rename your bins as 'PREFIX_Bin_00001', 'PREFIX_Bin_00002' and so on. If you use this flag, it will name the ones that meet the criteria described by MAG-related flags as 'PREFIX_MAG_00001', 'PREFIX_MAG_00002', and so on. The ones that do not get to be named as MAGs will remain as bins."/>
        <param name="min_completion_for_MAG" type="text" label="Min Completion For Mag" value="70" optional="True" argument="--min-completion-for-MAG" help="If --call-MAGs flag is used, call any bin a 'MAG' if their completion estimate is above this (the default is %(default)d), and the redundancy estimate is less than --max-redundancy-for-MAG."/>
        <param name="max_redundancy_for_MAG" type="text" label="Max Redundancy For Mag" value="10" optional="True" argument="--max-redundancy-for-MAG" help="If --call-MAGs flag is used, call any bin a 'MAG' if their redundancy estimate is below this (the default is %(default)d) and the completion estimate is above --min-completion-for-MAG."/>
        <param name="size_for_MAG" type="text" label="Size For Mag" value="0.0" optional="True" argument="--size-for-MAG" help="If --call-MAGs flag is used, call any bin a 'MAG' if their redundancy estimate is less than --max-redundancy-for-MAG, AND THEIR SIZE IS LARGER THAN THIS VALUE REGARDLESS OF THE COMPLETION ESTIMATE. The default behavior is to not care about this at all."/>
    </inputs>
    <outputs>
        <data name="output_contigs_db" format="anvio_contigs_db" format_source="input_contigs_db" metadata_source="input_contigs_db" label="${tool.name} on ${on_string}: Contigs Db"/>
        <data name="output_profile_db" format="anvio_profile_db" format_source="input_profile_db" metadata_source="input_profile_db" label="${tool.name} on ${on_string}: Profile Db"/>
        <data name="report_file" format="txt" format_source="input_report_file" metadata_source="input_report_file" label="${tool.name} on ${on_string}: Report File"/>
        <data name="GALAXY_ANVIO_LOG" format="txt" label="${tool.name} on ${on_string}: Log"/>
    </outputs>
    <help><![CDATA[
        usage: anvi-rename-bins [-h] -c CONTIGS_DB -p PROFILE_DB
                              [--collection-to-read COLLECTION_TO_READ]
                              [--collection-to-write COLLECTION_TO_WRITE]
                              [--prefix PREFIX]
                              [--report-file REPORT_FILE_PATH]
                              [--list-collections] [--dry-run] [--call-MAGs]
                              [--min-completion-for-MAG [0-100]]
                              [--max-redundancy-for-MAG [0-100]]
                              [--size-for-MAG MEGABASEPAIRS]

Rename all bins in a given collection (so they have pretty names).

optional arguments:
  -h, --help            show this help message and exit
  -c CONTIGS_DB, --contigs-db CONTIGS_DB
                        Anvi'o contigs database generated by 'anvi-gen-
                        contigs'
  -p PROFILE_DB, --profile-db PROFILE_DB
                        Anvi'o profile database
  --collection-to-read COLLECTION_TO_READ
                        Collection name to read from. Anvi'o will not
                        overwrite an existing collection, instead, it will
                        create a copy of your collection with new bin names.
  --collection-to-write COLLECTION_TO_WRITE
                        The new collection name. Give it a nice, fancy name.
  --prefix PREFIX       Prefix for the bin names. Must be a single word,
                        composed of digits and numbers. The use of the
                        underscore character is OK, but that's about it (fine,
                        the use of the dash character is OK, too but no
                        more!). If the prefix is 'PREFIX', each bin will be
                        renamed as 'PREFIX_XXX_00001, PREFIX_XXX_00002', and
                        so on, in the order of percent completion minus
                        percent redundancy (what we call, 'substantive
                        completion'). The 'XXX' part will either be 'Bin', or
                        'MAG depending on other parameters you use. Keep
                        reading.
  --report-file REPORT_FILE_PATH
                        This file will report each name change event, so you
                        can trace back the original names of renamed bins
                        later.
  --list-collections    Show available collections and exit.
  --dry-run             When used does NOT update the profile database, just
                        creates the report file so you can view how things
                        will be renamed.
  --call-MAGs           This program by default rename your bins as
                        'PREFIX_Bin_00001', 'PREFIX_Bin_00002' and so on. If
                        you use this flag, it will name the ones that meet the
                        criteria described by MAG-related flags as
                        'PREFIX_MAG_00001', 'PREFIX_MAG_00002', and so on. The
                        ones that do not get to be named as MAGs will remain
                        as bins.
  --min-completion-for-MAG [0-100]
                        If --call-MAGs flag is used, call any bin a 'MAG' if
                        their completion estimate is above this (the default
                        is 70), and the redundancy estimate is less than
                        --max-redundancy-for-MAG.
  --max-redundancy-for-MAG [0-100]
                        If --call-MAGs flag is used, call any bin a 'MAG' if
                        their redundancy estimate is below this (the default
                        is 10) and the completion estimate is above --min-
                        completion-for-MAG.
  --size-for-MAG MEGABASEPAIRS
                        If --call-MAGs flag is used, call any bin a 'MAG' if
                        their redundancy estimate is less than --max-
                        redundancy-for-MAG, AND THEIR SIZE IS LARGER THAN THIS
                        VALUE REGARDLESS OF THE COMPLETION ESTIMATE. The
                        default behavior is to not care about this at all.

DEFAULT INPUTS:
  Standard stuff

OUTPUT AND TESTING:
  a.k.a, sweet parameters of convenience

MAG OPTIONS:
  If you want to call some bins 'MAGs' because you are so cool

    ]]></help>
    <citations>
        <citation type="doi">10.7717/peerj.1319</citation>
        <citation type="bibtex">@ARTICLE{Blankenberg19-anvio,
   author = {Daniel Blankenberg, et al},
   title = {In preparation..},
   }</citation>
    </citations>
</tool>