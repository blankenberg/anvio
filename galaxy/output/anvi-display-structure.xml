<tool id="anvi_display_structure" name="anvi-display-structure" version="5.3.0" tool_type="interactive">
    <requirements>
        <requirement type="package" version="5.3.0">anvio</requirement>
    </requirements>
    <stdio>
        <exit_code range="1:" />
    </stdio>
    <version_command>anvi-display-structure --version</version_command>
    <command><![CDATA[
        cp -R '${input_structure_db.extra_files_path}' '${output_structure_db.extra_files_path}'
 && 

    #if $input_profile_db:
        cp -R '${input_profile_db.extra_files_path}' '${output_profile_db.extra_files_path}'
    #else
        echo ''
    #end if
 && 

    #if $input_contigs_db:
        cp -R '${input_contigs_db.extra_files_path}' '${output_contigs_db.extra_files_path}'
    #else
        echo ''
    #end if
 &&
 anvi-display-structure

#if $output_structure_db:
    --structure-db '${output_structure_db.extra_files_path}/${output_structure_db.metadata.anvio_basename}'
#end if

--profile-db '${output_profile_db.extra_files_path}/PROFILE.db'

--contigs-db '${output_contigs_db.extra_files_path}/CONTIGS.db'


#if $variability_profile:
    --variability-profile '${variability_profile}'
#end if


#if $splits_of_interest:
    --splits-of-interest '${splits_of_interest}'
#end if


#if $str( $collection_name ):
    --collection-name '${collection_name}'
#end if


#if $str( $bin_id ):
    --bin-id '${bin_id}'
#end if


#if $samples_of_interest:
    --samples-of-interest '${samples_of_interest}'
#end if


#if $genes_of_interest:
    --genes-of-interest '${genes_of_interest}'
#end if


#if $str( $gene_caller_ids ):
    --gene-caller-ids '${gene_caller_ids}'
#end if


#if $str( $min_departure_from_consensus ):
    --min-departure-from-consensus '${min_departure_from_consensus}'
#end if

${SAAVs_only}

${SCVs_only}


#if $str( $ip_address ):
    --ip-address '${ip_address}'
#end if


#if $str( $port_number ):
    --port-number '${port_number}'
#end if


#if $browser_path:
    --browser-path '${browser_path}'
#end if

${server_only}

${password_protected}

&> '${GALAXY_ANVIO_LOG}'

    ]]></command>
    <inputs>
        <param name="input_structure_db" type="data" label="Structure Db" format="anvio_structure_db" optional="False" multiple="False" argument="--structure-db" help="Anvi'o structure database."/>
        <param name="input_profile_db" type="data" label="Profile Db" format="anvio_profile_db" optional="True" multiple="False" argument="--profile-db" help="Anvi'o profile database"/>
        <param name="input_contigs_db" type="data" label="Contigs Db" format="anvio_contigs_db" optional="True" multiple="False" argument="--contigs-db" help="Anvi'o contigs database generated by 'anvi-gen-contigs'"/>
        <param name="variability_profile" type="data" label="Variability Profile" format="anvio_variability" optional="True" multiple="False" argument="--variability-profile" help="FIXME"/>
        <param name="splits_of_interest" type="data" label="Splits Of Interest" format="txt" optional="True" multiple="False" argument="--splits-of-interest" help="A file with split names. There should be only one column in the file, and each line should correspond to a unique split name."/>
        <param name="collection_name" type="text" label="Collection Name" value="" optional="True" argument="--collection-name" help="Collection name."/>
        <param name="bin_id" type="text" label="Bin Id" value="" optional="True" argument="--bin-id" help="If provided, any genes found in both your bin and your structure database will be available for display."/>
        <param name="samples_of_interest" type="data" label="Samples Of Interest" format="txt" optional="True" multiple="False" argument="--samples-of-interest" help="A file with samples names. There should be only one column in the file, and each line should correspond to a unique sample name (without a column header)."/>
        <param name="genes_of_interest" type="data" label="Genes Of Interest" format="txt" optional="True" multiple="False" argument="--genes-of-interest" help="A file with anvi'o gene caller IDs. There should be only one column in the file, and each line should correspond to a unique gene caller id (without a column header)."/>
        <param name="gene_caller_ids" type="text" label="Gene Caller Ids" value="" optional="True" argument="--gene-caller-ids" help="Gene caller ids. Multiple of them can be declared separated by a delimiter (the default is a comma). In anvi-gen-variability-profile, if you declare nothing you will get all genes matching your other filtering criteria. In other programs, you may get everything, nothing, or an error. It really depends on the situation. Fortunately mistakes are cheap, so it's worth a try."/>
        <param name="min_departure_from_consensus" type="float" label="Min Departure From Consensus" value="0.05" optional="True" argument="--min-departure-from-consensus" help="Takes a value between 0 and 1, where 1 is maximum divergence from the consensus. it can be an expensive operation to display every variable position, and so the default is 0.05. To display every variable position, set this parameter to 0"/>
        <param name="SAAVs_only" type="boolean" label="Saavs Only" truevalue="--SAAVs-only" falsevalue="" checked="" optional="True" argument="--SAAVs-only" help="If provided, variability will be generated for single amino acid variants (SAAVs) and not for single codon variants (SCVs). This could save you some time if you're only interested in SAAVs."/>
        <param name="SCVs_only" type="boolean" label="Scvs Only" truevalue="--SCVs-only" falsevalue="" checked="" optional="True" argument="--SCVs-only" help="If provided, variability will be generated for single codon variants (SCVs) and not for single amino acid variants (SAAVs). This could save you some time if you're only interested in SCVs."/>
        <param name="ip_address" type="text" label="Ip Address" value="0.0.0.0" optional="True" argument="--ip-address" help="IP address for the HTTP server. The default ip address (%(default)s) should work just fine for most."/>
        <param name="port_number" type="integer" label="Port Number" value="" optional="True" argument="--port-number" help="Port number to use for anvi'o services. If nothing is declared, anvi'o will try to find a suitable port number, starting from the default port number, 8080."/>
        <param name="browser_path" type="data" label="Browser Path" format="txt" optional="True" multiple="False" argument="--browser-path" help="By default, anvi'o will use your default browser to launch the interactive interface. If you would like to use something else than your system default, you can provide a full path for an alternative browser using this parameter, and hope for the best. For instance we are using this parameter to call Google's experimental browser, Canary, which performs better with demanding visualizations."/>
        <param name="server_only" type="boolean" label="Server Only" truevalue="--server-only" falsevalue="" checked="False" optional="True" argument="--server-only" help="The default behavior is to start the local server, and fire up a browser that connects to the server. If you have other plans, and want to start the server without calling the browser, this is the flag you need."/>
        <param name="password_protected" type="boolean" label="Password Protected" truevalue="--password-protected" falsevalue="" checked="False" optional="True" argument="--password-protected" help="If this flag is set, command line tool will ask you to enter a password and interactive interface will be only accessible after entering same password. This option is recommended for shared machines like clusters or shared networks where computers are not isolated."/>
    </inputs>
    <outputs>
        <data name="output_structure_db" format="anvio_structure_db" format_source="input_structure_db" metadata_source="input_structure_db" label="${tool.name} on ${on_string}: Structure Db"/>
        <data name="output_profile_db" format="anvio_profile_db" format_source="input_profile_db" metadata_source="input_profile_db" label="${tool.name} on ${on_string}: Profile Db"/>
        <data name="output_contigs_db" format="anvio_contigs_db" format_source="input_contigs_db" metadata_source="input_contigs_db" label="${tool.name} on ${on_string}: Contigs Db"/>
        <data name="GALAXY_ANVIO_LOG" format="txt" label="${tool.name} on ${on_string}: Log"/>
    </outputs>
    <help><![CDATA[
        usage: anvi-display-structure [-h] -s STRUCTURE_DB [-p PROFILE_DB]
                              [-c CONTIGS_DB] [-V VARIABILITY_TABLE]
                              [--splits-of-interest FILE] [-C COLLECTION_NAME]
                              [-b BIN_NAME] [--samples-of-interest FILE]
                              [--genes-of-interest FILE]
                              [--gene-caller-ids GENE_CALLER_IDS] [-j FLOAT]
                              [--SAAVs-only] [--SCVs-only] [-I IP_ADDR]
                              [-P INT] [--browser-path PATH] [--server-only]
                              [--password-protected]

optional arguments:
  -h, --help            show this help message and exit
  -s STRUCTURE_DB, --structure-db STRUCTURE_DB
                        Anvi'o structure database.
  -p PROFILE_DB, --profile-db PROFILE_DB
                        Anvi'o profile database
  -c CONTIGS_DB, --contigs-db CONTIGS_DB
                        Anvi'o contigs database generated by 'anvi-gen-
                        contigs'
  -V VARIABILITY_TABLE, --variability-profile VARIABILITY_TABLE
                        FIXME
  --splits-of-interest FILE
                        A file with split names. There should be only one
                        column in the file, and each line should correspond to
                        a unique split name.
  -C COLLECTION_NAME, --collection-name COLLECTION_NAME
                        Collection name.
  -b BIN_NAME, --bin-id BIN_NAME
                        If provided, any genes found in both your bin and your
                        structure database will be available for display.
  --samples-of-interest FILE
                        A file with samples names. There should be only one
                        column in the file, and each line should correspond to
                        a unique sample name (without a column header).
  --genes-of-interest FILE
                        A file with anvi'o gene caller IDs. There should be
                        only one column in the file, and each line should
                        correspond to a unique gene caller id (without a
                        column header).
  --gene-caller-ids GENE_CALLER_IDS
                        Gene caller ids. Multiple of them can be declared
                        separated by a delimiter (the default is a comma). In
                        anvi-gen-variability-profile, if you declare nothing
                        you will get all genes matching your other filtering
                        criteria. In other programs, you may get everything,
                        nothing, or an error. It really depends on the
                        situation. Fortunately mistakes are cheap, so it's
                        worth a try.
  -j FLOAT, --min-departure-from-consensus FLOAT
                        Takes a value between 0 and 1, where 1 is maximum
                        divergence from the consensus. it can be an expensive
                        operation to display every variable position, and so
                        the default is 0.05. To display every variable
                        position, set this parameter to 0
  --SAAVs-only          If provided, variability will be generated for single
                        amino acid variants (SAAVs) and not for single codon
                        variants (SCVs). This could save you some time if
                        you're only interested in SAAVs.
  --SCVs-only           If provided, variability will be generated for single
                        codon variants (SCVs) and not for single amino acid
                        variants (SAAVs). This could save you some time if
                        you're only interested in SCVs.
  -I IP_ADDR, --ip-address IP_ADDR
                        IP address for the HTTP server. The default ip address
                        (0.0.0.0) should work just fine for most.
  -P INT, --port-number INT
                        Port number to use for anvi'o services. If nothing is
                        declared, anvi'o will try to find a suitable port
                        number, starting from the default port number, 8080.
  --browser-path PATH   By default, anvi'o will use your default browser to
                        launch the interactive interface. If you would like to
                        use something else than your system default, you can
                        provide a full path for an alternative browser using
                        this parameter, and hope for the best. For instance we
                        are using this parameter to call Google's experimental
                        browser, Canary, which performs better with demanding
                        visualizations.
  --server-only         The default behavior is to start the local server, and
                        fire up a browser that connects to the server. If you
                        have other plans, and want to start the server without
                        calling the browser, this is the flag you need.
  --password-protected  If this flag is set, command line tool will ask you to
                        enter a password and interactive interface will be
                        only accessible after entering same password. This
                        option is recommended for shared machines like
                        clusters or shared networks where computers are not
                        isolated.

STRUCTURE:
  Information related to the structure database, which can be created with
  anvi-gen-structure-database.

VARIABILITY:
  We can overlay codon and amino acid variability in your metagenomes but we
  need a data source of this variability. Most simply, anvi'o can learn this
  information when you provide both your profile (-p) and contigs (-c)
  databases. Alternatively, you can provide a variability table output (-V)
  from the program anvi-gen-variability-profile. Finally, you can visualize
  the structures without overlaying variation by providing the flag --no-
  variability.

REFINING PARAMETERS:
  Which samples, genes, and contigs etc. are you interested in? Define that
  stuff here.

SERVER CONFIGURATION:
  For power users.

    ]]></help>
    <citations>
        <citation type="doi">10.7717/peerj.1319</citation>
        <citation type="bibtex">@ARTICLE{Blankenberg19-anvio,
   author = {Daniel Blankenberg, et al},
   title = {In preparation..},
   }</citation>
    </citations>
</tool>