<tool id="anvi_summarize" name="anvi-summarize" version="5.2">
    <description>Summarize an anvi'o collection. Fun stuff.</description>
    <requirements>
        <requirement type="package" version="5.2">anvio</requirement>
    </requirements>
    <stdio>
        <exit_code range="1:" />
    </stdio>
    <version_command>anvi-summarize --version</version_command>
    <command><![CDATA[
        cp -R '${input_pan_or_profile_db.extra_files_path}' '${output_pan_or_profile_db.extra_files_path}'
 && 

    #if $input_contigs_db:
        cp -R '${input_contigs_db.extra_files_path}' '${output_contigs_db.extra_files_path}'
    #else
        echo ''
    #end if
 && 

    #if $input_genomes_storage:
        cp -R '${input_genomes_storage.extra_files_path}' '${output_genomes_storage.extra_files_path}'
    #else
        echo ''
    #end if
 && 

    #if $input_cog_data_dir:
        cp -R '${input_cog_data_dir.extra_files_path}' '${output_cog_data_dir.extra_files_path}'
    #else
        echo ''
    #end if
 &&
 anvi-summarize

#if $output_pan_or_profile_db:
    --pan-or-profile-db '${output_pan_or_profile_db.extra_files_path}/${output_pan_or_profile_db.metadata.anvio_basename}'
#end if

--contigs-db '${output_contigs_db.extra_files_path}/CONTIGS.db'


#if $output_genomes_storage:
    --genomes-storage '${output_genomes_storage.extra_files_path}/${output_genomes_storage.metadata.anvio_basename}'
#end if

${init_gene_coverages}


#if $str( $collection_name ):
    --collection-name '${collection_name}'
#end if


#if $output_dir:
    --output-dir '${output_dir.extra_files_path}'
#end if

${list_collections}


#if $str( $taxonomic_level ):
    --taxonomic-level '${taxonomic_level}'
#end if

--cog-data-dir '${output_cog_data_dir.extra_files_path}'

${quick_summary}

--just-do-it
${report_aa_seqs_for_gene_calls}

&> '${GALAXY_ANVIO_LOG}'

 &&
ls -lahR
    ]]></command>
    <inputs>
        <param name="input_pan_or_profile_db" type="data" label="Pan Or Profile Db" format="anvio_profile_db,anvio_pan_db" optional="False" multiple="False" argument="--pan-or-profile-db" help="Anvi'o pan or profile database (and even genes database in appropriate contexts)."/>
        <param name="input_contigs_db" type="data" label="Contigs Db" format="anvio_contigs_db" optional="True" multiple="False" argument="--contigs-db" help="Anvi'o contigs database generated by 'anvi-gen-contigs'"/>
        <param name="input_genomes_storage" type="data" label="Genomes Storage" format="anvio_genomes_db" optional="True" multiple="False" argument="--genomes-storage" help="Anvi'o genomes storage file"/>
        <param name="init_gene_coverages" type="boolean" label="Init Gene Coverages" truevalue="--init-gene-coverages" falsevalue="" checked="False" optional="True" argument="--init-gene-coverages" help="Initialize gene coverage and detection data. This is a very computationally expensive step, but it is necessary when you need gene level coverage data. The reason this is very computationally expensive is because anvi'o computes gene coverages by going back to actual coverage values of each gene to average them, instead of using contig average coverage values, for extreme accuracy."/>
        <param name="collection_name" type="text" label="Collection Name" value="" optional="True" argument="--collection-name" help="Collection name."/>
        <param name="list_collections" type="boolean" label="List Collections" truevalue="--list-collections" falsevalue="" checked="False" optional="True" argument="--list-collections" help="Show available collections and exit."/>
        <param name="taxonomic_level" type="text" label="Taxonomic Level" value="t_genus" optional="True" argument="--taxonomic-level" help="The taxonomic level to use. The default is '%(default)s'. Only relevant if the anvi'o ontigs database contains taxonomic annotations."/>
        <param name="input_cog_data_dir" type="data" label="Cog Data Dir" format="anvio_cog_profile" optional="True" multiple="False" argument="--cog-data-dir" help="The directory path for your COG setup. Anvi'o will try to use the default path if you do not specify anything."/>
        <param name="quick_summary" type="boolean" label="Quick Summary" truevalue="--quick-summary" falsevalue="" checked="False" optional="True" argument="--quick-summary" help="When declared the summary output will be generated as quickly as possible, with minimum amount of essential information about bins."/>
        <param name="report_aa_seqs_for_gene_calls" type="boolean" label="Report Aa Seqs For Gene Calls" truevalue="--report-aa-seqs-for-gene-calls" falsevalue="" checked="False" optional="True" argument="--report-aa-seqs-for-gene-calls" help="You can use this flag if you would like to find translated DNA sequences for your gene calls in the genes output file."/>
    </inputs>
    <outputs>
        <data name="output_pan_or_profile_db" format="anvio_profile_db" format_source="input_pan_or_profile_db" metadata_source="input_pan_or_profile_db" label="${tool.name} on ${on_string}: Pan Or Profile Db"/>
        <data name="output_contigs_db" format="anvio_contigs_db" format_source="input_contigs_db" metadata_source="input_contigs_db" label="${tool.name} on ${on_string}: Contigs Db"/>
        <data name="output_genomes_storage" format="anvio_genomes_db" format_source="input_genomes_storage" metadata_source="input_genomes_storage" label="${tool.name} on ${on_string}: Genomes Storage"/>
        <data name="output_dir" format="anvio_profile_db" format_source="input_output_dir" metadata_source="input_output_dir" label="${tool.name} on ${on_string}: Output Dir"/>
        <data name="output_cog_data_dir" format="anvio_cog_profile" format_source="input_cog_data_dir" metadata_source="input_cog_data_dir" label="${tool.name} on ${on_string}: Cog Data Dir"/>
        <data name="GALAXY_ANVIO_LOG" format="txt" label="${tool.name} on ${on_string}: Log"/>
    </outputs>
    <help><![CDATA[
        usage: anvi-summarize [-h] -p PAN_OR_PROFILE_DB [-c CONTIGS_DB]
                              [-g GENOMES_STORAGE] [--init-gene-coverages]
                              [-C COLLECTION_NAME] [-o DIR_PATH]
                              [--list-collections]
                              [--taxonomic-level {t_phylum,t_class,t_order,t_family,t_genus,t_species}]
                              [--cog-data-dir COG_DATA_DIR] [--quick-summary]
                              [--just-do-it] [--report-aa-seqs-for-gene-calls]

Summarize an anvi'o collection. Fun stuff.

optional arguments:
  -h, --help            show this help message and exit
  -p PAN_OR_PROFILE_DB, --pan-or-profile-db PAN_OR_PROFILE_DB
                        Anvi'o pan or profile database (and even genes
                        database in appropriate contexts).
  -c CONTIGS_DB, --contigs-db CONTIGS_DB
                        Anvi'o contigs database generated by 'anvi-gen-
                        contigs'
  -g GENOMES_STORAGE, --genomes-storage GENOMES_STORAGE
                        Anvi'o genomes storage file
  --init-gene-coverages
                        Initialize gene coverage and detection data. This is a
                        very computationally expensive step, but it is
                        necessary when you need gene level coverage data. The
                        reason this is very computationally expensive is
                        because anvi'o computes gene coverages by going back
                        to actual coverage values of each gene to average
                        them, instead of using contig average coverage values,
                        for extreme accuracy.
  -C COLLECTION_NAME, --collection-name COLLECTION_NAME
                        Collection name.
  -o DIR_PATH, --output-dir DIR_PATH
                        Directory path for output files
  --list-collections    Show available collections and exit.
  --taxonomic-level {t_phylum,t_class,t_order,t_family,t_genus,t_species}
                        The taxonomic level to use. The default is 't_genus'.
                        Only relevant if the anvi'o ontigs database contains
                        taxonomic annotations.
  --cog-data-dir COG_DATA_DIR
                        The directory path for your COG setup. Anvi'o will try
                        to use the default path if you do not specify
                        anything.
  --quick-summary       When declared the summary output will be generated as
                        quickly as possible, with minimum amount of essential
                        information about bins.
  --just-do-it          Don't bother me with questions or warnings, just do
                        it.
  --report-aa-seqs-for-gene-calls
                        You can use this flag if you would like to find
                        translated DNA sequences for your gene calls in the
                        genes output file.

PROFILE:
  The profile. It could be a standard or pan profile database.

PROFILE TYPE SPECIFIC PARAMETERS:
  If you are summarizing a collection stored in a standard anvi'o profile,
  you will need a contigs database to go with it. If you are working with a
  pan profile, then you will need to provide a genomes storage. Don't worry
  too much, because anvi'o will warn you gently if you make a mistake.

STANDARD PROFILE SPECIFIC PARAMS:
  Parameters that are only relevant to standard profile summaries (declaring
  or not declaring them will not change anything if you are summarizing a
  pan profile).

COMMONS:
  Common parameters for both pan and standard profile summaries.

EXTRA:
  Extra stuff because you're extra.

    ]]></help>
    <citations>
        <citation type="doi">10.7717/peerj.1319</citation>
    </citations>
</tool>